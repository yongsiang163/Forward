<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Forward">
  <meta name="theme-color" content="#0e0b09">
  <title>Forward</title>
  <link rel="apple-touch-icon"
    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAIAAACyr5FlAAAFZ0lEQVR4nO3dTW7cRhBAYToIYAg2fDwtdBlBl9HC5zMQZJdFAwQzMzViN6vrr9+3jmVN8aWaQwmeb79+vGzAI395fwOIizggIg6IiAMi4oCIOCAiDoiIAyLigIg4ICIOiIgDIuKA6G/vb8DBz5fvA3/qzz//qn8nwdWPYyyFM1+nfC4149AK4vzfUjKUOnHYBHHmby8TSvo4fJt4aP+WsleSOI6AWdxo32HeRPLFEb+JG3kXSaY40mVxI90iyRFH9iyOEiUSPY5KWRylSCT04/OqZeyCv8CgmyP41BRFXiHh4lgni6OYicQ6VtYsYxft5QeKI9poXIQaQohjJdRE3MU5Yvw3B2U8FGEsznFEGEFY7sNxO1bcX3kKvkeMz+agjC5e43KIgzIGuAzNOg7KGGY/OtM4KOMi4wHaxUEZKizHaBQHZSgyG6ZFHJShzmak0+OgjEkMBuv/+BxhzY2DtTHV7PFOjIMyDEwd8qw4KMPMvFFzzwHRlDhYG8YmDVw/DspwMWPsynFQhiP14XPPAZHmb4K5r43fH28n/8vX98/hr9z7Zy39fPmu+GtjIX77PJc9lMiVqFA7VtzXhr3zi8qS4oXQiWPBMprfH28BE9G6HNyQKgjYhwqFOJZdG0fR+lC5KGwONdH6uO5qHKyNo1B9XL80bA6ILsXB2rhXaXmwOSAiDn2hlscV44/PVz5T9gfn8Tu48tMWNsclr++fD3/CEj+aMwbjWHlt3Av+E7jhi8Xm0BG8jzHEAdFIHJwpD90sj1C3HWOXjM0BEXFoKnbnQRwQdcfBDUdSAxeOzQERcUBEHBD1xcENx3Ohnm3c6718bA6IiEPNzdoo8MyDOCAiDh3B7zbGEIeCkmVsXb8myFuVe1IWYW84un5rkH+CYUTVVXGDY0Vf2LXRizggIg5lZdbGRhx4gjg0VVobG3EoKlbGRhxa6pWxEccZXz7VKFnGxkOw55bNomFziBZ5DPoEcTxw/l8XrR0QcTxQ+7A4jziuKrw8iOOxruVRtQ/iEHG4EIeOksujIw7FT3nJot7h0nUR2RwQEccX6i2P84jja8v2QRwQEccpay6PvjgWfMOyK9BH7+Vjc0BEHB0KLI8uxNFnqWfq3XGsfNvRK9TyGLhwbI5u6xwuxDFikcOFOKbLuzxG4uC2Y8t2uIxdMjYHRMQxLtfyGDAYBydLk6IPPh0S+sbjYHk0wZfHlcvE5lAQvI9hxAHRpTg4WXYxl8fFC8TmUFPvmfrVOFgeYwyWx/VLw+bQFPNwGaYQB8vjKMjhonJR2Byegi8PnThYHkcnl8fr++ekNaN1OdQ2B310mXf6KF4IjpUpnlz7eQtD3bdfP14Uvxwf2HNk/5GAuvubzWEky7Y4Ut4cG8vj/35/vJlloX7bpx/HRh8eZrwhmHKs8M7F2KSBc88B0aw4WB5m5o164uagDwNThzz3WKGPqWaPl3sOiKbHwfKYxGCwFpuDPtTZjNToWKEPRWbDtLvnoA8VlmM0vSGlj4uMB2j9boU+htmPzuGtLH0McBmaz3MO+ujiNS63Dx1uL5gf7j/n+3+R8xNSVsgT7sPxf3zuPoKYIowlxGfZc8QcRcii8d8cuzhDcRRqCIHi2IKNxl60lx/iWDla84iJlkUTLo5mnURiZtHEOlZuRB6ciuAvMOjm2FVdIcGzaKLH0VRKJEUWTY44muyJJMqiyRRHs484SyXpmtjli2MXf5HkzaJJHEcTcJFkb2KXPo7d8ZLYh1ImiKM6cRzZhFIyiKOacRzdX8KxXMqncK9+HPcWvMxjQj8+hy/igIg4ICIOiIgDIuKAiDggIg6IiAMi4oCIOCAiDoiIA6L/ANM3zXjR+SvfAAAAAElFTkSuQmCC">
  <link rel="manifest" href="manifest.json">
  <link
    href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=DM+Sans:wght@300;400&display=swap"
    rel="stylesheet">
  <style>
    /* ── DESIGN TOKENS — exact match to Rewind ── */
    :root {
      --bg: #0e0b09;
      --surface: #1a1410;
      --surface2: #221c16;
      --surface3: #2a2018;
      --warm: #c4956a;
      --warm-soft: #8b6540;
      --warm-glow: rgba(196, 149, 106, 0.12);
      --warm-glow-strong: rgba(196, 149, 106, 0.22);
      --teal: #7eb8a4;
      --teal-soft: #4d8a78;
      --teal-glow: rgba(126, 184, 164, 0.12);
      --teal-glow-strong: rgba(126, 184, 164, 0.22);
      --text: #e8ddd4;
      --text-soft: #9a8878;
      --text-muted: #5a4e45;
      --border: rgba(196, 149, 106, 0.15);
      --border-soft: rgba(255, 255, 255, 0.05);
      --border-teal: rgba(126, 184, 164, 0.18);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      height: 100%;
      background: #0e0b09;
    }

    body {
      height: 100%;
      overflow: hidden;
      background: #0e0b09;
      color: #e8ddd4;
      font-family: 'DM Sans', sans-serif;
      font-weight: 300;
    }

    /* ── AMBIENT — same as Rewind ── */
    .ambient {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
    }

    .ambient-orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0;
      transition: opacity 3s ease, background 1.5s ease;
    }

    .ambient-orb.a1 {
      width: 360px;
      height: 360px;
      background: radial-gradient(circle, rgba(196, 149, 106, 0.18), transparent 70%);
      top: -100px;
      right: -80px;
    }

    .ambient-orb.a2 {
      width: 280px;
      height: 280px;
      background: radial-gradient(circle, rgba(139, 101, 64, 0.13), transparent 70%);
      bottom: 8%;
      left: -100px;
    }

    .ambient-orb.visible {
      opacity: 1;
    }

    /* Plan mode shifts orbs to teal */
    body.mode-plan .ambient-orb.a1 {
      background: radial-gradient(circle, rgba(126, 184, 164, 0.14), transparent 70%);
    }

    body.mode-plan .ambient-orb.a2 {
      background: radial-gradient(circle, rgba(77, 138, 120, 0.09), transparent 70%);
    }

    /* ── GRAIN — same as Rewind ── */
    .grain {
      position: fixed;
      inset: 0;
      z-index: 1;
      pointer-events: none;
      opacity: 0.03;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      background-size: 128px;
    }

    /* ── APP SHELL ── */
    .app {
      position: relative;
      z-index: 2;
      height: 100%;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* mode-bar removed — navigation is gesture + orb */

    /* ── SCREENS ── */
    .screen {
      position: fixed;
      top: 0;
      bottom: 68px;
      left: 0;
      right: 0;
      display: flex;
      flex-direction: column;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease, transform 0.5s ease;
      transform: translateY(10px);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding-top: max(0px, env(safe-area-inset-top));
    }

    .screen.active {
      opacity: 1;
      pointer-events: all;
      transform: translateY(0);
    }

    /* Home screen — no scroll, hero must fill exactly */
    #screen-home {
      overflow: hidden;
    }

    /* ── HOME SCREEN — full viewport hero ── */
    /* (layout handled by .screen + #screen-home override above) */

    /* The hero fills the full viewport between mode bar and bottom nav */
    .home-hero {
      flex: 1;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 0 28px 28px;
      position: relative;
      text-align: center;
      touch-action: pan-y;
      /* Explicit overflow prevents flex children from escaping */
      overflow: hidden;
    }

    /* Wordmark — Forward, above the orb */
    .home-wordmark {
      font-family: 'Cormorant Garamond', serif;
      font-size: 13px;
      font-weight: 300;
      font-style: italic;
      letter-spacing: 6px;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 36px;
      opacity: 0;
      animation: fadeUp 0.8s ease 0.3s forwards;
      /* Sits naturally below safe-area, no fixed top needed */
    }

    /* State line — mood context, below wordmark */
    .home-state-line {
      font-size: 13px;
      color: var(--text-muted);
      letter-spacing: 0.4px;
      line-height: 1.7;
      margin-bottom: 44px;
      min-height: 20px;
      opacity: 0;
      animation: fadeUp 0.8s ease 0.5s forwards;
    }

    .home-state-line em {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      color: var(--warm);
      font-size: 16px;
    }

    /* ── HERO ORB — ring + inner fill + pulse ── */
    .hero-orb-wrap {
      position: relative;
      width: 130px;
      height: 130px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      margin-bottom: 20px;
      opacity: 0;
      animation: fadeUp 0.8s ease 0.65s forwards;
    }

    /* Outer breathing ring */
    .hero-ring {
      position: absolute;
      inset: 0;
      border-radius: 50%;
      border: 1.5px solid rgba(196, 149, 106, 0.3);
      animation: ringBreathe 4s ease-in-out infinite;
      transition: border-color 0.3s;
    }

    /* Second ring — offset phase */
    .hero-ring-2 {
      position: absolute;
      inset: 10px;
      border-radius: 50%;
      border: 1px solid rgba(196, 149, 106, 0.12);
      animation: ringBreathe 4s ease-in-out infinite;
      animation-delay: -2s;
    }

    /* Glow halo — outermost, very soft */
    .hero-ring-halo {
      position: absolute;
      inset: -14px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(196, 149, 106, 0.07), transparent 70%);
      animation: halobreathe 4s ease-in-out infinite;
      animation-delay: -1s;
    }

    /* Inner fill orb */
    .hero-orb-inner {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      background: radial-gradient(circle at 40% 38%, rgba(196, 149, 106, 0.32), rgba(196, 149, 106, 0.06) 70%);
      box-shadow:
        0 0 28px rgba(196, 149, 106, 0.14),
        inset 0 1px 1px rgba(255, 255, 255, 0.06);
      animation: orbBreathe 4s ease-in-out infinite;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 1;
    }

    /* + inside the orb */
    .hero-plus {
      font-size: 22px;
      color: var(--warm);
      line-height: 1;
      font-weight: 200;
      opacity: 0.85;
      margin-top: -1px;
      transition: opacity 0.2s;
    }

    /* Active / tap states */
    .hero-orb-wrap:active .hero-ring {
      border-color: rgba(196, 149, 106, 0.7);
    }

    .hero-orb-wrap:active .hero-orb-inner {
      background: radial-gradient(circle at 40% 38%, rgba(196, 149, 106, 0.52), rgba(196, 149, 106, 0.12) 70%);
      box-shadow: 0 0 44px rgba(196, 149, 106, 0.28), inset 0 1px 1px rgba(255, 255, 255, 0.08);
      transform: scale(0.93);
    }

    .hero-orb-wrap:active .hero-ring-halo {
      background: radial-gradient(circle, rgba(196, 149, 106, 0.18), transparent 70%);
    }

    /* Capture hint text below orb */
    .hero-capture-hint {
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--text-muted);
      opacity: 0;
      animation: fadeUp 0.8s ease 0.85s forwards;
      margin-bottom: 0;
    }

    /* Swipe direction hints — fade in late */
    .home-swipe-hints {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      padding: 0 4px;
      position: absolute;
      bottom: 28px;
      left: 0;
      right: 0;
      padding: 0 28px;
      opacity: 0;
      animation: fadeUp 0.8s ease 1.3s forwards;
      pointer-events: none;
    }

    .swipe-hint {
      display: flex;
      align-items: center;
      gap: 7px;
      font-size: 10px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .swipe-hint-arrow {
      font-size: 13px;
      color: var(--text-muted);
      opacity: 0.6;
    }

    .swipe-hint-teal {
      color: var(--teal-soft);
    }

    .swipe-hint-warm {
      color: var(--warm-soft);
    }

    /* Scroll-down section — stats revealed below fold */
    /* Stats drawer — fixed to bottom, hidden below viewport, revealed on swipe-up */
    .home-below-fold {
      position: fixed;
      bottom: 68px;
      /* sits just above bottom nav */
      left: 0;
      right: 0;
      padding: 24px 28px 28px;
      border-top: 1px solid var(--border-soft);
      display: flex;
      gap: 10px;
      background: rgba(14, 11, 9, 0.95);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      transform: translateY(calc(100% + 68px));
      transition: transform 0.42s cubic-bezier(0.32, 0.72, 0, 1);
      z-index: 20;
      border-radius: 20px 20px 0 0;
      /* Hidden on non-home screens */
      visibility: hidden;
    }

    .home-below-fold.revealed {
      transform: translateY(0);
    }

    /* Only show on home screen */
    body.on-home .home-below-fold {
      visibility: visible;
    }

    /* Pull handle — fixed above bottom nav, only on home */
    .stats-handle {
      position: fixed;
      bottom: calc(68px + 10px);
      left: 50%;
      transform: translateX(-50%);
      width: 32px;
      height: 3px;
      background: var(--text-muted);
      border-radius: 2px;
      opacity: 0;
      transition: opacity 0.5s ease;
      pointer-events: none;
      z-index: 19;
      visibility: hidden;
    }

    body.on-home .stats-handle {
      visibility: visible;
    }

    .stats-handle.visible {
      opacity: 0.28;
    }

    /* Hide handle when drawer is open */
    .home-below-fold.revealed~* .stats-handle,
    body.stats-open .stats-handle {
      opacity: 0;
    }

    /* ── ANIMATIONS — orb life ── */
    @keyframes ringBreathe {

      0%,
      100% {
        transform: scale(0.94);
        opacity: 0.7;
      }

      50% {
        transform: scale(1.04);
        opacity: 1;
      }
    }

    @keyframes halobreathe {

      0%,
      100% {
        transform: scale(0.92);
        opacity: 0.6;
      }

      50% {
        transform: scale(1.08);
        opacity: 1;
      }
    }

    @keyframes orbBreathe {

      0%,
      100% {
        transform: scale(0.93);
      }

      50% {
        transform: scale(1.05);
      }
    }

    /* Rewind connection card */
    .rewind-card {
      background: var(--surface);
      border: 1px solid var(--border-soft);
      border-radius: 14px;
      padding: 16px 18px;
      display: flex;
      align-items: center;
      gap: 14px;
      margin-top: 16px;
      opacity: 0;
      animation: fadeUp 0.7s ease 0.45s forwards;
      cursor: default;
    }

    .rewind-card-orb {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      flex-shrink: 0;
      background: radial-gradient(circle, var(--warm-glow-strong), transparent);
      animation: breathe 4s ease-in-out infinite;
    }

    .rewind-card-text {
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .rewind-card-text strong {
      color: var(--warm);
      font-weight: 400;
    }

    .rewind-card-arrow {
      margin-left: auto;
      font-size: 14px;
      color: var(--text-muted);
    }

    /* capture hero replaced by hero-orb-wrap */

    /* Stats cards — below fold */
    .home-stat-card {
      flex: 1;
      background: var(--surface);
      border: 1px solid var(--border-soft);
      border-radius: 14px;
      padding: 16px 16px 14px;
      cursor: pointer;
      transition: border-color 0.25s, box-shadow 0.25s;
      display: flex;
      flex-direction: column;
      gap: 5px;
      position: relative;
      overflow: hidden;
    }

    .home-stat-card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at top left, var(--warm-glow), transparent 65%);
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
    }

    .home-stat-card:active {
      border-color: var(--border);
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
    }

    .home-stat-card:active::before {
      opacity: 1;
    }

    .home-stat-num {
      font-family: 'Cormorant Garamond', serif;
      font-size: 30px;
      color: var(--warm);
      line-height: 1;
    }

    .home-stat-label {
      font-size: 10px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-muted);
    }


    /* ── ORIENTATION PILL — fades in on mode entry, dissolves after 2s ── */
    .mode-pill {
      position: fixed;
      top: max(16px, env(safe-area-inset-top));
      left: 50%;
      transform: translateX(-50%);
      z-index: 40;
      padding: 7px 20px;
      border-radius: 20px;
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      font-family: 'DM Sans', sans-serif;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.5s ease;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      white-space: nowrap;
    }

    .mode-pill.plan {
      background: rgba(126, 184, 164, 0.12);
      border: 1px solid rgba(126, 184, 164, 0.2);
      color: var(--teal);
    }

    .mode-pill.work {
      background: rgba(196, 149, 106, 0.12);
      border: 1px solid rgba(196, 149, 106, 0.2);
      color: var(--warm);
    }

    .mode-pill.visible {
      opacity: 1;
    }

    /* Orb state colour shifts */
    .hero-orb-wrap.state-plan .hero-ring {
      border-color: rgba(126, 184, 164, 0.35);
    }

    .hero-orb-wrap.state-plan .hero-orb-inner {
      background: radial-gradient(circle at 40% 38%, rgba(126, 184, 164, 0.32), rgba(126, 184, 164, 0.06) 70%);
      box-shadow: 0 0 28px rgba(126, 184, 164, 0.14), inset 0 1px 1px rgba(255, 255, 255, 0.06);
    }

    .hero-orb-wrap.state-plan .hero-ring-halo {
      background: radial-gradient(circle, rgba(126, 184, 164, 0.07), transparent 70%);
    }

    .hero-orb-wrap.state-plan .hero-plus {
      color: var(--teal);
    }

    /* Plan screen header padding — needs space for safe area */
    .plan-header {
      padding: max(48px, calc(env(safe-area-inset-top) + 28px)) 28px 0;
    }

    /* Work screen padding */
    #screen-work {
      padding: max(48px, calc(env(safe-area-inset-top) + 28px)) 28px 20px;
    }

    /* Settings padding */
    #screen-settings {
      padding: max(48px, calc(env(safe-area-inset-top) + 28px)) 28px;
    }

    /* ── PLAN SCREEN ── */
    #screen-plan {
      padding: 0;
    }

    .plan-eyebrow {
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--teal-soft);
      margin-bottom: 6px;
    }

    .plan-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 30px;
      font-weight: 300;
      color: var(--text);
    }

    /* Filter chips */
    .filter-row {
      display: flex;
      gap: 8px;
      padding: 20px 28px 0;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }

    .filter-row::-webkit-scrollbar {
      display: none;
    }

    .filter-chip {
      flex-shrink: 0;
      background: var(--surface);
      border: 1px solid var(--border-soft);
      border-radius: 20px;
      padding: 7px 16px;
      font-size: 11px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .filter-chip.active {
      border-color: var(--teal);
      color: var(--teal);
      background: var(--teal-glow);
    }

    /* Inbox list */
    .inbox-list {
      padding: 16px 28px 0;
    }

    /* Inbox item */
    .inbox-item {
      background: var(--surface);
      border: 1px solid var(--border-soft);
      border-radius: 14px;
      padding: 18px 20px 16px;
      margin-bottom: 10px;
      position: relative;
      overflow: hidden;
      animation: fadeUp 0.3s ease forwards;
      transition: border-color 0.25s, box-shadow 0.25s;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.18);
    }

    .inbox-item::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at top left, rgba(255, 255, 255, 0.025), transparent 60%);
      pointer-events: none;
      border-radius: inherit;
    }

    .inbox-item:active {
      border-color: var(--border);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.28);
    }

    .inbox-item.status-quiet {
      opacity: 0.52;
    }

    /* Category left bar */
    .inbox-item-bar {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      border-radius: 3px 0 0 3px;
    }

    .cat-task .inbox-item-bar {
      background: var(--warm-soft);
    }

    .cat-project .inbox-item-bar {
      background: var(--teal);
    }

    .cat-spark .inbox-item-bar {
      background: #9b8ec4;
    }

    .cat-reminder .inbox-item-bar {
      background: #c4846a;
    }

    .cat-uncategorised .inbox-item-bar {
      background: var(--text-muted);
    }

    .inbox-item-content {
      font-family: 'Cormorant Garamond', serif;
      font-size: 19px;
      color: var(--text);
      line-height: 1.55;
      margin-bottom: 12px;
    }

    .inbox-item-footer {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .inbox-item-time {
      font-size: 11px;
      color: var(--text-muted);
      letter-spacing: 0.5px;
    }

    /* Category tag */
    .cat-tag {
      font-size: 10px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      padding: 4px 10px;
      border-radius: 12px;
      background: var(--surface2);
      cursor: pointer;
      transition: all 0.2s;
    }

    .cat-tag.pending {
      border: 1px dashed var(--border-soft);
    }

    .cat-tag.confirmed {
      opacity: 0.7;
      cursor: default;
    }

    .cat-task .cat-tag {
      color: var(--warm-soft);
    }

    .cat-project .cat-tag {
      color: var(--teal-soft);
    }

    .cat-spark .cat-tag {
      color: #9b8ec4;
    }

    .cat-reminder .cat-tag {
      color: #c4846a;
    }

    .cat-uncategorised .cat-tag {
      color: var(--text-muted);
    }

    .ai-suggest-hint {
      font-size: 10px;
      color: var(--text-muted);
      font-style: italic;
      letter-spacing: 0.3px;
    }

    .ai-pending-dot {
      display: inline-block;
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: var(--warm-soft);
      margin-right: 5px;
      animation: pulseDot 2s ease-in-out infinite;
    }

    .inbox-item-archive {
      margin-left: auto;
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 16px;
      cursor: pointer;
      padding: 2px 8px;
      opacity: 0.4;
      transition: opacity 0.2s;
      line-height: 1;
    }

    .inbox-item-archive:active {
      opacity: 1;
    }

    /* Quiet collapsed block */
    .quiet-block {
      background: var(--surface);
      border: 1px dashed var(--border-soft);
      border-radius: 12px;
      padding: 14px 20px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: border-color 0.2s;
    }

    .quiet-block:active {
      border-color: var(--text-muted);
    }

    .quiet-block-label {
      font-size: 12px;
      color: var(--text-muted);
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .quiet-block-chevron {
      margin-left: auto;
      font-size: 13px;
      color: var(--text-muted);
      transition: transform 0.3s;
    }

    .quiet-block.open .quiet-block-chevron {
      transform: rotate(180deg);
    }

    /* Empty state */
    .inbox-empty {
      text-align: center;
      padding: 64px 20px 40px;
    }

    .inbox-empty-orb {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      margin: 0 auto 20px;
      background: radial-gradient(circle, var(--teal-glow), transparent);
      animation: breathe 4s ease-in-out infinite;
    }

    .inbox-empty-text {
      font-family: 'Cormorant Garamond', serif;
      font-size: 20px;
      color: var(--text-muted);
      font-style: italic;
      line-height: 1.6;
    }

    /* ── WORK SCREEN ── */
    #screen-work {
      padding: max(52px, calc(env(safe-area-inset-top) + 28px)) 28px 20px;
    }

    .work-eyebrow {
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--warm-soft);
      margin-bottom: 8px;
      opacity: 0;
      animation: fadeUp 0.6s ease 0.2s forwards;
    }

    .work-headline {
      font-family: 'Cormorant Garamond', serif;
      font-size: 28px;
      font-weight: 300;
      color: var(--text);
      line-height: 1.35;
      margin-bottom: 28px;
      opacity: 0;
      animation: fadeUp 0.6s ease 0.35s forwards;
    }

    /* Task card */
    .task-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 26px 22px;
      margin-bottom: 14px;
      position: relative;
      overflow: hidden;
      opacity: 0;
      animation: fadeUp 0.6s ease 0.5s forwards;
      box-shadow: 0 2px 24px rgba(0, 0, 0, 0.22), 0 0 0 0.5px rgba(196, 149, 106, 0.08) inset;
    }

    .task-card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at top left, var(--warm-glow-strong), transparent 60%);
      pointer-events: none;
    }

    .task-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(to right, rgba(196, 149, 106, 0.18), transparent);
      pointer-events: none;
    }

    .task-card-context {
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--warm-soft);
      margin-bottom: 10px;
    }

    .task-card-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 26px;
      font-weight: 300;
      color: var(--text);
      line-height: 1.45;
      margin-bottom: 24px;
    }

    .task-card-btns {
      display: flex;
      gap: 10px;
    }

    .task-btn {
      flex: 1;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--warm);
      font-family: 'DM Sans', sans-serif;
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 13px 10px;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.25s;
    }

    .task-btn.primary {
      background: var(--warm-glow);
      border-color: var(--warm);
    }

    .task-btn.muted {
      color: var(--text-muted);
      border-color: var(--border-soft);
      font-size: 10px;
    }

    .task-btn:active {
      background: var(--warm-glow);
      transform: scale(0.97);
    }

    /* Help Me Start */
    .help-btn {
      width: 100%;
      background: transparent;
      border: 1px dashed var(--border);
      color: var(--warm-soft);
      font-family: 'DM Sans', sans-serif;
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 13px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.25s;
      margin-bottom: 14px;
      opacity: 0;
      animation: fadeUp 0.6s ease 0.65s forwards;
    }

    .help-btn:active {
      border-color: var(--warm);
      color: var(--warm);
      background: var(--warm-glow);
    }

    /* MVNA steps */
    .mvna-wrap {
      background: var(--surface2);
      border: 1px solid var(--border-soft);
      border-radius: 14px;
      padding: 18px 18px;
      margin-bottom: 14px;
      display: none;
    }

    .mvna-wrap.visible {
      display: block;
    }

    .mvna-step {
      display: flex;
      align-items: flex-start;
      gap: 14px;
      padding: 11px 0;
      border-bottom: 1px solid var(--border-soft);
      opacity: 0.3;
      transition: opacity 0.35s;
    }

    .mvna-step:last-child {
      border-bottom: none;
    }

    .mvna-step.current {
      opacity: 1;
    }

    .mvna-step.done {
      opacity: 0.32;
    }

    .mvna-step-num {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      border: 1px solid var(--border-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: var(--text-muted);
      flex-shrink: 0;
      margin-top: 1px;
      transition: all 0.3s;
    }

    .mvna-step.current .mvna-step-num {
      border-color: var(--warm);
      color: var(--warm);
    }

    .mvna-step.done .mvna-step-num {
      background: var(--warm-soft);
      border-color: var(--warm-soft);
      color: var(--bg);
    }

    .mvna-step-text {
      font-family: 'Cormorant Garamond', serif;
      font-size: 18px;
      color: var(--text);
      line-height: 1.5;
      flex: 1;
    }

    .mvna-done-btn {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 20px;
      cursor: pointer;
      padding: 0 4px;
      opacity: 0;
      transition: opacity 0.25s;
      flex-shrink: 0;
      line-height: 1;
    }

    .mvna-step.current .mvna-done-btn {
      opacity: 1;
    }

    /* AI loading orb */
    .ai-thinking {
      display: none;
      flex-direction: column;
      align-items: center;
      padding: 32px 0 20px;
      gap: 16px;
    }

    .ai-thinking.visible {
      display: flex;
    }

    .ai-thinking-orb {
      width: 54px;
      height: 54px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(196, 149, 106, 0.38), rgba(196, 149, 106, 0.04));
      animation: breathe 2.4s ease-in-out infinite;
    }

    .ai-thinking-label {
      font-size: 12px;
      color: var(--text-muted);
      letter-spacing: 2px;
      font-style: italic;
    }

    /* Work empty */
    .work-empty {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 32px 20px;
      gap: 18px;
      opacity: 0;
      animation: fadeUp 0.6s ease 0.5s forwards;
    }

    .work-empty-text {
      font-family: 'Cormorant Garamond', serif;
      font-size: 22px;
      color: var(--text-muted);
      font-style: italic;
      line-height: 1.65;
    }

    .work-empty-cta {
      font-size: 11px;
      color: var(--text-muted);
      letter-spacing: 1.5px;
      text-transform: uppercase;
      cursor: pointer;
      padding: 8px;
    }

    /* ── FOCUS OVERLAY ── */
    .focus-overlay {
      position: fixed;
      inset: 0;
      z-index: 80;
      background: var(--bg);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 32px;
    }

    .focus-overlay.active {
      display: flex;
    }

    /* Peripheral time glow — edge border only, never intrusive */
    .focus-time-ring {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 79;
      border: 2.5px solid transparent;
      transition: border-color 3s ease;
      border-radius: 0;
    }

    .focus-time-ring.glow-45 {
      border-color: rgba(196, 149, 106, 0.1);
    }

    .focus-time-ring.glow-90 {
      border-color: rgba(196, 149, 106, 0.22);
    }

    .focus-task-eyebrow {
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 18px;
    }

    .focus-task-text {
      font-family: 'Cormorant Garamond', serif;
      font-size: 30px;
      font-weight: 300;
      color: var(--text);
      text-align: center;
      line-height: 1.45;
      margin-bottom: 44px;
      max-width: 340px;
    }

    .focus-btns {
      display: flex;
      gap: 12px;
    }

    .focus-btn {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--warm);
      font-family: 'DM Sans', sans-serif;
      font-size: 11px;
      letter-spacing: 2.5px;
      text-transform: uppercase;
      padding: 14px 28px;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.25s;
    }

    .focus-btn:active {
      background: var(--warm-glow);
      transform: scale(0.97);
    }

    .focus-btn.exit {
      color: var(--text-muted);
      border-color: var(--border-soft);
      font-size: 10px;
    }

    .focus-gentle-msg {
      position: fixed;
      bottom: max(32px, env(safe-area-inset-bottom));
      left: 32px;
      right: 32px;
      font-size: 13px;
      color: var(--text-muted);
      text-align: center;
      font-style: italic;
      opacity: 0;
      transition: opacity 1s ease;
      pointer-events: none;
    }

    .focus-gentle-msg.visible {
      opacity: 1;
    }

    /* ── SETTINGS SCREEN ── */
    #screen-settings {
      padding: max(52px, calc(env(safe-area-inset-top) + 28px)) 28px 28px;
    }

    .settings-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 32px;
      font-weight: 300;
      color: var(--text);
      margin-bottom: 28px;
    }

    .settings-section {
      margin-bottom: 24px;
    }

    .settings-section-label {
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .settings-row {
      background: var(--surface);
      border: 1px solid var(--border-soft);
      border-radius: 12px;
      padding: 16px 18px;
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: border-color 0.2s;
    }

    .settings-row:active {
      border-color: var(--border);
    }

    .settings-row-body {
      flex: 1;
    }

    .settings-row-text {
      font-size: 15px;
      color: var(--text);
      margin-bottom: 2px;
    }

    .settings-row-sub {
      font-size: 12px;
      color: var(--text-muted);
    }

    .settings-row-action {
      font-size: 13px;
      color: var(--text-muted);
      flex-shrink: 0;
    }

    .settings-row-action.on {
      color: var(--teal);
      font-size: 11px;
      letter-spacing: 1px;
    }

    /* ── CAPTURE SHEET ── */
    .capture-sheet {
      position: fixed;
      inset: 0;
      z-index: 100;
      display: none;
      flex-direction: column;
    }

    .capture-sheet.active {
      display: flex;
    }

    .capture-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(14, 11, 9, 0.85);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .capture-modal {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--surface);
      border-top: 1px solid var(--border-soft);
      border-radius: 24px 24px 0 0;
      padding: 20px 24px max(28px, env(safe-area-inset-bottom));
      transform: translateY(100%);
      transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1);
    }

    .capture-sheet.active .capture-modal {
      transform: translateY(0);
    }

    .capture-handle {
      width: 36px;
      height: 4px;
      border-radius: 2px;
      background: var(--border-soft);
      margin: 0 auto 22px;
    }

    .capture-textarea {
      width: 100%;
      background: transparent;
      border: none;
      color: var(--text);
      font-family: 'Cormorant Garamond', serif;
      font-size: 22px;
      font-weight: 300;
      line-height: 1.55;
      resize: none;
      outline: none;
      min-height: 100px;
      max-height: 220px;
      margin-bottom: 14px;
    }

    .capture-textarea::placeholder {
      color: var(--text-muted);
      font-style: italic;
    }

    .capture-footer {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .capture-char {
      font-size: 11px;
      color: var(--text-muted);
      min-width: 20px;
    }

    .capture-actions {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .capture-trash {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 18px;
      cursor: pointer;
      padding: 8px;
      opacity: 0.4;
      transition: opacity 0.2s;
      line-height: 1;
    }

    .capture-trash:active {
      opacity: 1;
    }

    .capture-save {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--warm);
      font-family: 'DM Sans', sans-serif;
      font-size: 11px;
      letter-spacing: 2.5px;
      text-transform: uppercase;
      padding: 11px 22px;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.25s;
    }

    .capture-save:active {
      background: var(--warm-glow);
      border-color: var(--warm);
      transform: scale(0.97);
    }

    /* ── BOTTOM NAV — same structure as Rewind ── */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 30;
      display: flex;
      background: rgba(14, 11, 9, 0.92);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-top: 1px solid var(--border-soft);
      padding: 10px 0 max(10px, env(safe-area-inset-bottom));
    }

    .nav-btn {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 0;
    }

    .nav-icon {
      font-size: 19px;
      line-height: 1;
      filter: grayscale(1) opacity(0.35);
      transition: filter 0.3s;
    }

    .nav-label {
      font-size: 9px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-muted);
      transition: color 0.3s;
    }

    .nav-btn.active .nav-icon {
      filter: none;
    }

    .nav-btn.active-plan .nav-icon {
      filter: none;
      color: var(--teal);
    }

    .nav-btn.active-plan .nav-label {
      color: var(--teal);
    }

    .nav-btn.active-work .nav-icon {
      filter: none;
      color: var(--warm);
    }

    .nav-btn.active-work .nav-label {
      color: var(--warm);
    }

    .nav-btn.active .nav-label {
      color: var(--warm);
    }

    /* Centre capture button */
    .nav-capture-wrap {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .nav-capture-btn {
      width: 46px;
      height: 46px;
      border-radius: 50%;
      background: transparent;
      border: 1.5px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--warm);
      font-size: 22px;
      line-height: 1;
      margin-top: -6px;
    }

    .nav-capture-btn:active {
      border-color: var(--warm);
      background: var(--warm-glow);
      transform: scale(0.92);
    }

    /* ── TOAST — same as Rewind ── */
    .toast {
      position: fixed;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: var(--surface2);
      border: 1px solid var(--border);
      color: var(--warm);
      font-size: 12px;
      letter-spacing: 0.5px;
      padding: 10px 24px;
      border-radius: 40px;
      opacity: 0;
      transition: all 0.3s ease;
      pointer-events: none;
      white-space: nowrap;
      z-index: 200;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* ── ANIMATIONS — same as Rewind ── */
    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(12px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes breathe {

      0%,
      100% {
        transform: scale(0.9);
        opacity: 0.55;
      }

      50% {
        transform: scale(1.1);
        opacity: 1;
      }
    }

    @keyframes pulseDot {

      0%,
      100% {
        opacity: 0.35;
      }

      50% {
        opacity: 1;
      }
    }

    .scroll-pad {
      height: 28px;
      flex-shrink: 0;
    }

    /* ── ORB RADIAL MENU — long press blooms Plan / Work ── */
    .orb-menu {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 2;
    }

    /* Each option radiates from orb centre */
    .orb-option {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.6);
      opacity: 0;
      transition: transform 0.38s cubic-bezier(0.34, 1.56, 0.64, 1),
        opacity 0.28s ease;
      pointer-events: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    .hero-orb-wrap.menu-open .orb-option {
      opacity: 1;
      pointer-events: all;
    }

    /* Plan — blooms upward-left */
    .orb-option.opt-plan {
      transform: translate(calc(-50% - 80px), calc(-50% - 90px)) scale(0.6);
    }

    .hero-orb-wrap.menu-open .orb-option.opt-plan {
      transform: translate(calc(-50% - 80px), calc(-50% - 90px)) scale(1);
    }

    /* Work — blooms upward-right */
    .orb-option.opt-work {
      transform: translate(calc(-50% + 80px), calc(-50% - 90px)) scale(0.6);
    }

    .hero-orb-wrap.menu-open .orb-option.opt-work {
      transform: translate(calc(-50% + 80px), calc(-50% - 90px)) scale(1);
    }

    .orb-option-btn {
      width: 54px;
      height: 54px;
      border-radius: 50%;
      background: var(--surface2);
      border: 1px solid var(--border-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s, transform 0.15s;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.32);
    }

    .orb-option-btn:active {
      transform: scale(0.92);
    }

    .opt-plan .orb-option-btn {
      border-color: var(--border-teal);
    }

    .opt-plan .orb-option-btn:active {
      background: var(--teal-glow);
    }

    .opt-work .orb-option-btn {
      border-color: var(--border);
    }

    .opt-work .orb-option-btn:active {
      background: var(--warm-glow);
    }

    .orb-option-icon {
      font-size: 18px;
      line-height: 1;
    }

    .orb-option-label {
      font-size: 9px;
      letter-spacing: 2px;
      text-transform: uppercase;
    }

    .opt-plan .orb-option-label {
      color: var(--teal-soft);
    }

    .opt-work .orb-option-label {
      color: var(--warm-soft);
    }

    /* Orb dims slightly while menu open */
    .hero-orb-wrap.menu-open .hero-orb-inner {
      opacity: 0.6;
    }

    .hero-orb-wrap.menu-open .hero-plus {
      opacity: 0;
    }

    /* Scrim behind orb when menu open */
    .orb-scrim {
      position: fixed;
      inset: 0;
      z-index: 4;
      display: none;
      background: transparent;
    }

    .orb-scrim.active {
      display: block;
    }


    /* ══════════════════════════════════════════════════
   LIVING PROJECTS
   ══════════════════════════════════════════════════ */

    /* Project cards in Plan screen */
    .project-section {
      padding: 0 20px;
      margin-bottom: 8px;
    }

    .project-section-label {
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--teal-soft);
      margin-bottom: 12px;
      padding: 0 4px;
    }

    .project-card {
      background: var(--surface);
      border: 1px solid var(--border-soft);
      border-radius: 16px;
      padding: 20px 20px 16px;
      margin-bottom: 10px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: border-color 0.25s, box-shadow 0.2s;
      box-shadow: 0 2px 14px rgba(0, 0, 0, 0.2);
    }

    .project-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(to right, rgba(126, 184, 164, 0.25), transparent 60%);
    }

    .project-card::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at top left, rgba(126, 184, 164, 0.06), transparent 60%);
      pointer-events: none;
    }

    .project-card:active {
      border-color: var(--border-teal);
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.28);
    }

    .project-card-name {
      font-size: 15px;
      color: var(--text);
      font-weight: 400;
      margin-bottom: 6px;
      line-height: 1.35;
    }

    .project-card-vision {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      font-size: 14px;
      color: var(--text-soft);
      line-height: 1.55;
      margin-bottom: 14px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .project-card-footer {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .project-phase-pill {
      font-size: 9px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 4px 10px;
      border-radius: 10px;
      background: rgba(126, 184, 164, 0.1);
      border: 1px solid rgba(126, 184, 164, 0.2);
      color: var(--teal);
    }

    .project-next-action {
      font-size: 12px;
      color: var(--text-muted);
      flex: 1;
      min-width: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .project-next-action::before {
      content: '→ ';
      color: var(--warm-soft);
    }

    /* Add project button */
    .add-project-btn {
      width: 100%;
      background: none;
      border: 1px dashed rgba(126, 184, 164, 0.2);
      border-radius: 14px;
      padding: 14px;
      cursor: pointer;
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--teal-soft);
      transition: border-color 0.2s, color 0.2s;
      margin-bottom: 20px;
    }

    .add-project-btn:active {
      border-color: var(--teal-soft);
      color: var(--teal);
    }

    /* ── PROJECT DETAIL SHEET ── */
    .project-sheet {
      position: fixed;
      inset: 0;
      z-index: 80;
      display: none;
      flex-direction: column;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }

    .project-sheet.active {
      display: flex;
    }

    .project-sheet-modal {
      margin-top: auto;
      background: var(--surface);
      border-radius: 24px 24px 0 0;
      border-top: 1px solid var(--border-soft);
      max-height: 88vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      animation: sheetUp 0.38s cubic-bezier(0.32, 0.72, 0, 1);
    }

    @keyframes sheetUp {
      from {
        transform: translateY(100%);
      }

      to {
        transform: translateY(0);
      }
    }

    .project-sheet-handle {
      width: 36px;
      height: 4px;
      border-radius: 2px;
      background: var(--text-muted);
      opacity: 0.3;
      margin: 14px auto 0;
      flex-shrink: 0;
    }

    .project-sheet-scroll {
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding: 20px 24px 40px;
      flex: 1;
    }

    .project-sheet-section {
      margin-bottom: 28px;
    }

    .project-sheet-eyebrow {
      font-size: 9px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .project-sheet-name {
      font-size: 20px;
      color: var(--text);
      font-weight: 400;
      margin-bottom: 0;
      border: none;
      background: none;
      width: 100%;
      font-family: 'DM Sans', sans-serif;
      padding: 0;
      outline: none;
      caret-color: var(--warm);
    }

    .project-vision-text {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      font-size: 17px;
      color: var(--text-soft);
      line-height: 1.65;
      padding: 16px;
      background: rgba(255, 255, 255, 0.025);
      border-radius: 12px;
      border-left: 2px solid rgba(196, 149, 106, 0.2);
    }

    .project-vision-locked {
      font-size: 9px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-muted);
      opacity: 0.5;
      margin-top: 8px;
    }

    /* Phase selector */
    .phase-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .phase-pill-btn {
      background: none;
      border: 1px solid var(--border-soft);
      border-radius: 20px;
      padding: 7px 14px;
      font-size: 10px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.2s;
    }

    .phase-pill-btn.active {
      background: rgba(126, 184, 164, 0.12);
      border-color: rgba(126, 184, 164, 0.35);
      color: var(--teal);
    }

    /* Next action input */
    .project-input {
      width: 100%;
      background: var(--surface2);
      border: 1px solid var(--border-soft);
      border-radius: 12px;
      padding: 14px 16px;
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      font-weight: 300;
      outline: none;
      resize: none;
      caret-color: var(--warm);
      transition: border-color 0.2s;
    }

    .project-input:focus {
      border-color: var(--border);
    }

    .project-input::placeholder {
      color: var(--text-muted);
    }

    /* Save button */
    .project-save-btn {
      width: 100%;
      padding: 16px;
      background: rgba(196, 149, 106, 0.12);
      border: 1px solid rgba(196, 149, 106, 0.25);
      border-radius: 14px;
      color: var(--warm);
      font-size: 11px;
      letter-spacing: 2.5px;
      text-transform: uppercase;
      cursor: pointer;
      margin-top: 8px;
      transition: background 0.2s, border-color 0.2s;
    }

    .project-save-btn:active {
      background: rgba(196, 149, 106, 0.2);
    }

    /* ── NEW PROJECT FLOW ── */
    .new-project-sheet {
      position: fixed;
      inset: 0;
      z-index: 90;
      display: none;
      flex-direction: column;
      background: rgba(0, 0, 0, 0.55);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }

    .new-project-sheet.active {
      display: flex;
    }

    .new-project-modal {
      margin-top: auto;
      background: var(--surface);
      border-radius: 24px 24px 0 0;
      border-top: 1px solid var(--border-soft);
      padding: 14px 24px max(32px, env(safe-area-inset-bottom));
      animation: sheetUp 0.38s cubic-bezier(0.32, 0.72, 0, 1);
    }

    .new-project-handle {
      width: 36px;
      height: 4px;
      border-radius: 2px;
      background: var(--text-muted);
      opacity: 0.3;
      margin: 0 auto 24px;
    }

    .new-project-step {
      display: none;
    }

    .new-project-step.active {
      display: block;
    }

    .new-project-label {
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .new-project-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 22px;
      font-style: italic;
      color: var(--text);
      margin-bottom: 20px;
      line-height: 1.3;
    }

    .new-project-next {
      width: 100%;
      padding: 15px;
      background: rgba(126, 184, 164, 0.1);
      border: 1px solid rgba(126, 184, 164, 0.25);
      border-radius: 14px;
      color: var(--teal);
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      cursor: pointer;
      margin-top: 16px;
      transition: background 0.2s;
    }

    .new-project-next:active {
      background: rgba(126, 184, 164, 0.18);
    }

    .new-project-back {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 11px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      cursor: pointer;
      padding: 10px 0;
      display: block;
      margin: 10px auto 0;
    }


    /* Develop button on project inbox items */
    .inbox-item-develop {
      background: none;
      border: 1px solid rgba(126, 184, 164, 0.25);
      border-radius: 8px;
      padding: 4px 10px;
      font-size: 10px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--teal-soft);
      cursor: pointer;
      transition: border-color 0.2s, color 0.2s;
      white-space: nowrap;
    }

    .inbox-item-develop:active {
      border-color: var(--teal);
      color: var(--teal);
    }


    /* ══ PROJECT CATEGORIES ══ */
    .cat-badge {
      display: inline-block;
      font-size: 9px;
      letter-spacing: 1.8px;
      text-transform: uppercase;
      padding: 3px 9px;
      border-radius: 8px;
      margin-bottom: 8px;
      font-family: 'DM Sans', sans-serif;
    }

    .cat-badge-idwork {
      background: rgba(126, 184, 164, 0.12);
      color: var(--teal);
      border: 1px solid rgba(126, 184, 164, 0.22);
    }

    .cat-badge-life {
      background: rgba(196, 149, 106, 0.12);
      color: var(--warm);
      border: 1px solid rgba(196, 149, 106, 0.22);
    }

    .cat-badge-business {
      background: rgba(180, 140, 200, 0.12);
      color: #b48cc8;
      border: 1px solid rgba(180, 140, 200, 0.22);
    }

    .cat-badge-learning {
      background: rgba(100, 160, 220, 0.12);
      color: #6aa0dc;
      border: 1px solid rgba(100, 160, 220, 0.22);
    }

    .cat-badge-open {
      background: rgba(255, 255, 255, 0.06);
      color: var(--text-soft);
      border: 1px solid var(--border-soft);
    }

    /* ══ PROJECTS SCREEN ══ */
    #screen-projects {
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .projects-header {
      padding: max(48px, calc(env(safe-area-inset-top) + 24px)) 24px 0;
      flex-shrink: 0;
    }

    .projects-eyebrow {
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--teal-soft);
      margin-bottom: 6px;
    }

    .projects-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 28px;
      font-weight: 300;
      color: var(--text);
      margin-bottom: 16px;
    }

    /* Category filter pills */
    .cat-filter-row {
      display: flex;
      gap: 8px;
      padding: 0 24px 16px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      flex-shrink: 0;
    }

    .cat-filter-row::-webkit-scrollbar {
      display: none;
    }

    .cat-filter-chip {
      flex-shrink: 0;
      background: var(--surface);
      border: 1px solid var(--border-soft);
      border-radius: 20px;
      padding: 7px 16px;
      cursor: pointer;
      font-size: 10px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-muted);
      transition: all 0.2s;
      white-space: nowrap;
    }

    .cat-filter-chip.active {
      background: rgba(126, 184, 164, 0.1);
      border-color: rgba(126, 184, 164, 0.3);
      color: var(--teal);
    }

    .projects-list {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding: 0 20px 20px;
    }

    /* ══ UPDATED PROJECT CARD ══ */
    .project-card {
      background: var(--surface);
      border: 1px solid var(--border-soft);
      border-radius: 16px;
      padding: 18px 18px 14px;
      margin-bottom: 10px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: border-color 0.25s, box-shadow 0.2s;
      box-shadow: 0 2px 14px rgba(0, 0, 0, 0.2);
    }

    .project-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(to right, rgba(126, 184, 164, 0.2), transparent 60%);
    }

    .project-card:active {
      border-color: var(--border-teal);
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.28);
    }

    .project-card-name {
      font-size: 15px;
      color: var(--text);
      font-weight: 400;
      margin-bottom: 6px;
    }

    .project-card-vision {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      font-size: 14px;
      color: var(--text-soft);
      line-height: 1.55;
      margin-bottom: 12px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .project-card-footer {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .project-next-preview {
      font-size: 12px;
      color: var(--text-muted);
      flex: 1;
      min-width: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .project-next-preview::before {
      content: '→ ';
      color: var(--warm-soft);
    }

    .add-project-btn {
      width: 100%;
      background: none;
      border: 1px dashed rgba(126, 184, 164, 0.2);
      border-radius: 14px;
      padding: 14px;
      cursor: pointer;
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--teal-soft);
      transition: border-color 0.2s, color 0.2s;
      margin-bottom: 20px;
    }

    .add-project-btn:active {
      border-color: var(--teal-soft);
      color: var(--teal);
    }

    /* ══ INBOX SCREEN ══ */
    #screen-inbox {
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .inbox-header {
      padding: max(48px, calc(env(safe-area-inset-top) + 24px)) 24px 0;
      flex-shrink: 0;
    }

    .inbox-eyebrow {
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--warm-soft);
      margin-bottom: 6px;
    }

    .inbox-screen-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 28px;
      font-weight: 300;
      color: var(--text);
      margin-bottom: 0;
    }

    /* ══ INBOX ITEM ACTION SHEET ══ */
    .item-action-sheet {
      position: fixed;
      inset: 0;
      z-index: 85;
      display: none;
      flex-direction: column;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }

    .item-action-sheet.active {
      display: flex;
    }

    .item-action-modal {
      margin-top: auto;
      background: var(--surface);
      border-radius: 24px 24px 0 0;
      border-top: 1px solid var(--border-soft);
      padding: 14px 0 max(32px, env(safe-area-inset-bottom));
      animation: sheetUp 0.32s cubic-bezier(0.32, 0.72, 0, 1);
    }

    .item-action-handle {
      width: 36px;
      height: 4px;
      border-radius: 2px;
      background: var(--text-muted);
      opacity: 0.3;
      margin: 0 auto 20px;
    }

    .item-action-content {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      font-size: 15px;
      color: var(--text-soft);
      line-height: 1.5;
      padding: 0 24px 20px;
      border-bottom: 1px solid var(--border-soft);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .item-action-label {
      font-size: 9px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--text-muted);
      padding: 16px 24px 8px;
    }

    .item-action-row {
      display: flex;
      gap: 8px;
      padding: 0 24px;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }

    .item-action-cat-btn {
      background: var(--surface2);
      border: 1px solid var(--border-soft);
      border-radius: 20px;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 10px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-muted);
      transition: all 0.2s;
    }

    .item-action-cat-btn.active {
      background: rgba(196, 149, 106, 0.1);
      border-color: rgba(196, 149, 106, 0.3);
      color: var(--warm);
    }

    .item-action-divider {
      height: 1px;
      background: var(--border-soft);
      margin: 12px 24px;
    }

    .item-action-main-btn {
      width: calc(100% - 48px);
      margin: 0 24px 8px;
      padding: 15px;
      background: none;
      border: 1px solid var(--border-soft);
      border-radius: 14px;
      color: var(--text-soft);
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.2s;
      display: block;
      text-align: center;
    }

    .item-action-main-btn.promote {
      background: rgba(126, 184, 164, 0.08);
      border-color: rgba(126, 184, 164, 0.25);
      color: var(--teal);
    }

    .item-action-main-btn.promote:active {
      background: rgba(126, 184, 164, 0.15);
    }

    .item-action-main-btn.archive {
      background: none;
      border-color: var(--border-soft);
      color: var(--text-muted);
    }

    .item-action-main-btn.cancel {
      border: none;
      color: var(--text-muted);
      opacity: 0.6;
    }

    /* ══ ARCHIVE SECTION IN INBOX ══ */
    .archive-toggle {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      cursor: pointer;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
    }

    .archive-toggle-arrow {
      transition: transform 0.2s;
    }

    .archive-toggle.open .archive-toggle-arrow {
      transform: rotate(180deg);
    }

    .archive-list {
      padding: 0 20px;
      display: none;
    }

    .archive-list.open {
      display: block;
    }

    .archived-item {
      background: var(--surface);
      border: 1px solid var(--border-soft);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 8px;
      opacity: 0.5;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .archived-item-text {
      flex: 1;
      font-size: 13px;
      color: var(--text-soft);
    }

    .archived-item-restore {
      background: none;
      border: 1px solid var(--border-soft);
      border-radius: 8px;
      padding: 5px 10px;
      font-size: 9px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--text-muted);
      cursor: pointer;
      white-space: nowrap;
    }

    .archived-item-restore:active {
      border-color: var(--warm);
      color: var(--warm);
    }

    /* ══ UPDATED PROJECT DETAIL SHEET ══ */
    .project-sheet-modal {
      max-height: 92vh;
    }

    .project-ai-section {
      border-top: 1px solid var(--border-soft);
      padding-top: 20px;
      margin-top: 4px;
    }

    .project-ai-btn {
      width: 100%;
      padding: 16px;
      background: rgba(196, 149, 106, 0.08);
      border: 1px solid rgba(196, 149, 106, 0.2);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .project-ai-btn:active {
      background: rgba(196, 149, 106, 0.15);
    }

    .project-ai-btn-label {
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--warm);
    }

    .project-ai-orb {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--warm);
      opacity: 0.6;
      animation: orbBreathe 3s ease-in-out infinite;
    }

    /* AI chat thread inside project */
    .project-ai-thread {
      margin-top: 14px;
      display: none;
    }

    .project-ai-thread.open {
      display: block;
    }

    .ai-message {
      background: var(--surface2);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 10px;
    }

    .ai-message-text {
      font-size: 13px;
      color: var(--text-soft);
      line-height: 1.65;
    }

    .ai-message-text em {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      color: var(--text);
      font-size: 15px;
    }

    .ai-step-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 0;
      border-bottom: 1px solid var(--border-soft);
    }

    .ai-step-item:last-child {
      border-bottom: none;
    }

    .ai-step-check {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 1px solid var(--border);
      background: none;
      cursor: pointer;
      flex-shrink: 0;
      margin-top: 1px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .ai-step-check.done {
      background: rgba(196, 149, 106, 0.2);
      border-color: var(--warm);
    }

    .ai-step-check.done::after {
      content: '✓';
      font-size: 9px;
      color: var(--warm);
    }

    .ai-step-text {
      font-size: 13px;
      color: var(--text-soft);
      line-height: 1.5;
      flex: 1;
    }

    .ai-step-text.done {
      text-decoration: line-through;
      opacity: 0.4;
    }

    .project-ai-input-row {
      display: flex;
      gap: 8px;
      margin-top: 14px;
    }

    .project-ai-input {
      flex: 1;
      background: var(--surface2);
      border: 1px solid var(--border-soft);
      border-radius: 12px;
      padding: 12px 14px;
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 300;
      outline: none;
      caret-color: var(--warm);
    }

    .project-ai-input::placeholder {
      color: var(--text-muted);
    }

    .project-ai-send {
      background: rgba(196, 149, 106, 0.12);
      border: 1px solid rgba(196, 149, 106, 0.25);
      border-radius: 12px;
      padding: 0 16px;
      color: var(--warm);
      cursor: pointer;
      font-size: 16px;
      transition: background 0.2s;
    }

    .project-ai-send:active {
      background: rgba(196, 149, 106, 0.22);
    }

    /* AI thinking indicator */
    .ai-thinking-inline {
      display: none;
      align-items: center;
      gap: 8px;
      padding: 10px 0;
    }

    .ai-thinking-inline.visible {
      display: flex;
    }

    .ai-thinking-inline-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--warm);
      animation: orbBreathe 1.2s ease-in-out infinite;
    }

    .ai-thinking-inline-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .ai-thinking-inline-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    /* ══ NEW PROJECT FLOW — updated for category ══ */
    .np-category-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 4px;
    }

    .np-cat-btn {
      background: var(--surface2);
      border: 1px solid var(--border-soft);
      border-radius: 12px;
      padding: 12px 14px;
      cursor: pointer;
      text-align: left;
      transition: all 0.2s;
    }

    .np-cat-btn.active {
      border-color: rgba(126, 184, 164, 0.4);
      background: rgba(126, 184, 164, 0.08);
    }

    .np-cat-btn-name {
      font-size: 12px;
      color: var(--text);
      margin-bottom: 2px;
      font-weight: 400;
    }

    .np-cat-btn-desc {
      font-size: 10px;
      color: var(--text-muted);
    }
  </style>
</head>

<body>

  <!-- Ambient + grain — exact Rewind pattern -->
  <div class="ambient">
    <div class="ambient-orb a1"></div>
    <div class="ambient-orb a2"></div>
  </div>
  <div class="grain"></div>

  <!-- FOCUS TIME RING — peripheral awareness, never intrusive -->
  <div class="focus-time-ring" id="focus-time-ring"></div>

  <!-- FOCUS OVERLAY -->
  <div class="focus-overlay" id="focus-overlay">
    <p class="focus-task-eyebrow">In focus</p>
    <p class="focus-task-text" id="focus-task-text">—</p>
    <div class="focus-btns">
      <button class="focus-btn" onclick="completeFocus()">Done ✓</button>
      <button class="focus-btn exit" onclick="exitFocus()">Pause</button>
    </div>
    <p class="focus-gentle-msg" id="focus-gentle-msg">You've been here a while.</p>
  </div>

  <!-- CAPTURE SHEET -->
  <div class="capture-sheet" id="capture-sheet">
    <div class="capture-backdrop" onclick="dismissCapture()"></div>
    <div class="capture-modal">
      <div class="capture-handle"></div>
      <textarea class="capture-textarea" id="capture-textarea" placeholder="What's on your mind..." rows="4"
        oninput="onCaptureType()"></textarea>
      <div class="capture-footer">
        <span class="capture-char" id="capture-char">0</span>
        <div class="capture-actions">
          <button class="capture-trash" onclick="trashCapture()" title="Discard">✕</button>
          <button class="capture-save" onclick="saveCapture()">Keep it →</button>
        </div>
      </div>
    </div>
  </div>

  <div class="app">

    <!-- Orientation pill — injected by JS, floats and dissolves -->
    <div class="mode-pill" id="mode-pill"></div>
    <!-- Swipe-up handle — fixed, visible only on home -->
    <div class="stats-handle" id="stats-handle"></div>

    <!-- HOME SCREEN — full viewport hero with swipe navigation -->
    <div class="screen active" id="screen-home">

      <!-- Hero fills viewport -->
      <div class="home-hero" id="home-hero">
        <p class="home-wordmark">Forward</p>
        <p class="home-state-line" id="home-state-line"></p>

        <!-- The living orb — tap to capture -->
        <div class="hero-orb-wrap" id="hero-orb-wrap" onclick="openCapture()">
          <div class="hero-ring-halo"></div>
          <div class="hero-ring"></div>
          <div class="hero-ring-2"></div>
          <div class="hero-orb-inner" id="hero-orb-inner">
            <span class="hero-plus">+</span>
          </div>
        </div>

        <p class="hero-capture-hint">tap to capture</p>

        <!-- Swipe direction hints -->
        <div class="home-swipe-hints">
          <div class="swipe-hint swipe-hint-teal">
            <span class="swipe-hint-arrow">←</span>
            <span>Plan</span>
          </div>
          <div class="swipe-hint swipe-hint-warm">
            <span>Work</span>
            <span class="swipe-hint-arrow">→</span>
          </div>
        </div>
      </div>

      <!-- Stats drawer — hidden, slides up from fixed bottom position -->
      <div class="home-below-fold" id="home-below-fold">
        <div class="home-stat-card" onclick="showScreen('plan')">
          <span class="home-stat-num" id="stat-inbox">0</span>
          <span class="home-stat-label">In inbox</span>
        </div>
        <div class="home-stat-card" onclick="showScreen('plan')">
          <span class="home-stat-num" id="stat-fresh">0</span>
          <span class="home-stat-label">Fresh today</span>
        </div>
      </div>

    </div>

    <!-- PROJECTS SCREEN -->
    <div class="screen" id="screen-projects">
      <div class="projects-header">
        <p class="projects-eyebrow">Your work</p>
        <h2 class="projects-title">Projects</h2>
      </div>
      <div class="cat-filter-row" id="cat-filter-row">
        <button class="cat-filter-chip active" data-cat="all" onclick="setCatFilter(this,'all')">All</button>
        <button class="cat-filter-chip" data-cat="idwork" onclick="setCatFilter(this,'idwork')">ID Work</button>
        <button class="cat-filter-chip" data-cat="life" onclick="setCatFilter(this,'life')">Life</button>
        <button class="cat-filter-chip" data-cat="business" onclick="setCatFilter(this,'business')">Business</button>
        <button class="cat-filter-chip" data-cat="learning" onclick="setCatFilter(this,'learning')">Learning</button>
        <button class="cat-filter-chip" data-cat="open" onclick="setCatFilter(this,'open')">Open</button>
      </div>
      <div class="projects-list" id="project-cards">
        <button class="add-project-btn" onclick="openNewProject(null)">+ new project</button>
      </div>
    </div>

    <!-- INBOX SCREEN -->
    <div class="screen" id="screen-inbox">
      <div class="inbox-header">
        <p class="inbox-eyebrow">Captured</p>
        <h2 class="inbox-screen-title" id="inbox-title">Everything</h2>
      </div>
      <div class="filter-row" id="filter-row" style="padding: 16px 24px 0">
        <button class="filter-chip active" data-filter="all" onclick="setFilter(this,'all')">All</button>
        <button class="filter-chip" data-filter="task" onclick="setFilter(this,'task')">Tasks</button>
        <button class="filter-chip" data-filter="spark" onclick="setFilter(this,'spark')">Sparks</button>
        <button class="filter-chip" data-filter="reminder" onclick="setFilter(this,'reminder')">Reminders</button>
        <button class="filter-chip" data-filter="uncategorised"
          onclick="setFilter(this,'uncategorised')">Unsorted</button>
      </div>
      <div class="inbox-list" id="inbox-list"></div>
      <!-- Archive section -->
      <button class="archive-toggle" id="archive-toggle" onclick="toggleArchive()">
        <span class="archive-toggle-arrow">▾</span>
        <span>Archived</span>
      </button>
      <div class="archive-list" id="archive-list"></div>
      <div class="scroll-pad"></div>
    </div>

    <!-- WORK SCREEN -->
    <div class="screen" id="screen-work">
      <p class="work-eyebrow" id="work-eyebrow">Right now</p>
      <p class="work-headline" id="work-headline">—</p>
      <div id="work-area"></div>
      <div class="ai-thinking" id="ai-thinking">
        <div class="ai-thinking-orb"></div>
        <span class="ai-thinking-label">thinking...</span>
      </div>
      <div class="scroll-pad"></div>
    </div>

    <!-- SETTINGS SCREEN -->
    <div class="screen" id="screen-settings">
      <h2 class="settings-title">Settings</h2>

      <div class="settings-section">
        <p class="settings-section-label">Data</p>
        <div class="settings-row" onclick="exportData()">
          <div class="settings-row-body">
            <p class="settings-row-text">Back up your Forward data</p>
            <p class="settings-row-sub">Export everything as JSON</p>
          </div>
          <span class="settings-row-action">↓</span>
        </div>
      </div>

      <div class="settings-section">
        <p class="settings-section-label">Focus protection</p>
        <div class="settings-row">
          <div class="settings-row-body">
            <p class="settings-row-text">Gentle time awareness</p>
            <p class="settings-row-sub">Soft glow at 45 min · message at 120 min</p>
          </div>
          <span class="settings-row-action on">On</span>
        </div>
        <div class="settings-row">
          <div class="settings-row-body">
            <p class="settings-row-text">Family time hours</p>
            <p class="settings-row-sub">Not yet configured</p>
          </div>
          <span class="settings-row-action">→</span>
        </div>
      </div>

      <div class="settings-section">
        <p class="settings-section-label">About</p>
        <div class="settings-row" style="cursor:default;">
          <div class="settings-row-body">
            <p class="settings-row-text">Forward</p>
            <p class="settings-row-sub">Version 1.0 · Companion to Rewind</p>
          </div>
        </div>
      </div>
      <div class="scroll-pad"></div>
    </div>

  </div><!-- /app -->

  <!-- BOTTOM NAV — Home · Projects · Capture · Inbox · More -->
  <nav class="bottom-nav">
    <button class="nav-btn active" id="nav-home" onclick="showScreen('home')">
      <span class="nav-icon">⬡</span>
      <span class="nav-label">Home</span>
    </button>
    <button class="nav-btn" id="nav-projects" onclick="showScreen('projects')">
      <span class="nav-icon" style="color:var(--teal)">◫</span>
      <span class="nav-label">Projects</span>
    </button>
    <div class="nav-capture-wrap">
      <button class="nav-capture-btn" onclick="openCapture()">+</button>
    </div>
    <button class="nav-btn" id="nav-inbox" onclick="showScreen('inbox')">
      <span class="nav-icon" style="color:var(--warm)">▤</span>
      <span class="nav-label">Inbox</span>
    </button>
    <button class="nav-btn" id="nav-settings" onclick="showScreen('settings')">
      <span class="nav-icon">○</span>
      <span class="nav-label">More</span>
    </button>
  </nav>

  <div class="toast" id="toast"></div>

  <script>
    // ═══════════════════════════════════════════════════════
    // FORWARD v1.0 · Core Logic
    // ═══════════════════════════════════════════════════════

    // ── CONSTANTS ──────────────────────────────────────────
    const CAT_LABELS = { task: 'Task', project: 'Project', spark: 'Spark', reminder: 'Reminder', uncategorised: 'Uncategorised' };

    // Differentiated lifecycle by category — the core graveyard prevention logic
    const LIFECYCLE = {
      task: { freshHrs: 48, quietDays: 7, archiveDays: 30 },
      project: { freshHrs: Infinity, quietDays: 9, archiveDays: Infinity }, // never auto-archived
      spark: { freshHrs: 48, quietDays: null, archiveDays: 7 },        // goes straight to archive at 7 days
      reminder: { freshHrs: 48, quietDays: null, archiveDays: null },     // handled by date
      uncategorised: { freshHrs: 48, quietDays: 7, archiveDays: 30 }
    };

    // Rewind mood → attention state map
    const MOOD_MAP = {
      Alive: { state: 'focused', label: 'You\'re alive and ready.', maxSteps: 3 },
      Calm: { state: 'drifting', label: 'Calm today. One steady thing.', maxSteps: 3 },
      Okay: { state: 'drifting', label: 'Okay is enough. One step.', maxSteps: 2 },
      Restless: { state: 'drifting', label: 'Restless energy. One channel.', maxSteps: 2 },
      Tired: { state: 'fatigued', label: 'Tired. One very small thing.', maxSteps: 1 },
      Heavy: { state: 'fatigued', label: 'Running heavy. Just one thing.', maxSteps: 1 }
    };

    // Interior design phase context — sent to AI for domain-aware suggestions
    const PHASE_CONTEXT = {
      concept: 'Concept phase: mood boards, spatial direction, client brief alignment, reference gathering. Suggestions should be exploratory and creative.',
      development: 'Development phase: drawings, specifications, material selections, design presentations. Suggestions should be precise and document-oriented.',
      procurement: 'Procurement phase: supplier sourcing, quotes, purchase orders, lead times, follow-ups. Suggestions should be administrative and sequential.',
      site: 'Site phase: site visits, contractor coordination, installation supervision, punch lists. Suggestions should be immediate, physical, and time-aware.',
      delivery: 'Delivery phase: client handover, final documentation, photography, snagging. Suggestions should be completionist and detail-oriented.'
    };

    // ── APP STATE ───────────────────────────────────────────
    const S = {
      screen: 'home',
      filter: 'all',
      rewindSession: null,
      attentionState: null,
      maxSteps: 3,
      quietExpanded: false,
      currentWorkItem: null,
      mvnaSteps: [],
      mvnaStep: 0,
      focusActive: false,
      focusStart: null,
      focusTimer: null
    };

    let items = [];

    // ── STORAGE ─────────────────────────────────────────────
    function save() {
      try { localStorage.setItem('forward_items', JSON.stringify(items)); } catch (e) { }
    }

    function load() {
      try {
        const d = localStorage.getItem('forward_items');
        if (d) items = JSON.parse(d);
      } catch (e) { items = []; }
    }

    function loadRewind() {
      try {
        const d = localStorage.getItem('rewind_sessions');
        if (!d) return null;
        const arr = JSON.parse(d);
        if (!arr.length) return null;
        const last = arr[arr.length - 1];
        const ageHrs = (Date.now() - new Date(last.date)) / 3600000;
        return ageHrs <= 24 ? last : null;
      } catch (e) { return null; }
    }

    // ── LIFECYCLE ENGINE ─────────────────────────────────────
    function computeStatus(item) {
      if (item.status === 'archived') return 'archived';
      const now = Date.now();
      const created = new Date(item.createdAt).getTime();
      const touched = new Date(item.touchedAt || item.createdAt).getTime();
      const ageHrs = (now - created) / 3600000;
      const touchedDays = (now - touched) / 86400000;
      const lc = LIFECYCLE[item.category] || LIFECYCLE.uncategorised;

      if (lc.archiveDays !== null && lc.archiveDays !== Infinity && touchedDays > lc.archiveDays) return 'archived';
      if (lc.quietDays && touchedDays > lc.quietDays) return 'quiet';
      if (ageHrs <= (lc.freshHrs || 48)) return 'fresh';
      return 'alive';
    }

    function runLifecycle() {
      let changed = false;
      items.forEach(item => {
        const s = computeStatus(item);
        if (s !== item.status) { item.status = s; changed = true; }
      });
      if (changed) save();
    }

    // ── AI CATEGORISATION (placeholder — swap for Claude API) ──
    function aiCategorise(text) {
      return new Promise(resolve => {
        setTimeout(() => {
          const t = text.toLowerCase();
          let cat = 'task';
          if (/idea|thought|what if|maybe|imagine|feeling|noticed|spark/i.test(t)) cat = 'spark';
          else if (/client|project|phase|design|proposal|presentation|procurement|drawing|spec/i.test(t)) cat = 'project';
          else if (/remind|deadline|due|call|meeting|at \d|by \d/i.test(t)) cat = 'reminder';
          resolve({ category: cat });
        }, 700);
      });
    }

    // ── HELP ME START (placeholder — swap for Claude API) ────
    // Full payload shape is ready for real API: task, projectId, projectPhase, moodState, completedSteps
    function helpMeStartAI({ task, projectPhase, moodState, maxSteps, completedSteps = [] }) {
      return new Promise(resolve => {
        setTimeout(() => {
          const t = task.toLowerCase();
          let steps = [];

          // Phase-aware suggestions (simplified placeholder; real AI uses PHASE_CONTEXT)
          if (projectPhase === 'procurement') {
            steps = ['Open your supplier list', 'Find the first unconfirmed quote', 'Send one follow-up message'];
          } else if (projectPhase === 'site') {
            steps = ['Open your site checklist', 'Note the first unresolved item', 'Call or message the relevant contractor'];
          } else if (/email|send|reply|message/i.test(t)) {
            steps = ['Open your email and find the thread', 'Read the last message only', 'Type one sentence to start your reply'];
          } else if (/call|phone|ring/i.test(t)) {
            steps = ['Find the contact in your phone', 'Press call'];
          } else if (/document|write|draft|report|proposal/i.test(t)) {
            steps = ['Open the document', 'Read the last paragraph you wrote', 'Write one sentence — any sentence'];
          } else if (/research|find|look|search/i.test(t)) {
            steps = ['Open one browser tab', 'Type the first search term that comes to mind'];
          } else {
            steps = [
              `Open whatever you need for: "${task}"`,
              'Look at it for 30 seconds',
              'Do the single smallest first action'
            ];
          }

          // Enforce hard cap — maxSteps is 1 for Heavy/Fatigued states
          steps = steps.slice(0, maxSteps);
          resolve(steps);
        }, 1800); // deliberate delay — shows loading orb, proves latency handling
      });
    }

    // ── CAPTURE ──────────────────────────────────────────────
    function openCapture() {
      const sheet = document.getElementById('capture-sheet');
      const ta = document.getElementById('capture-textarea');
      sheet.classList.add('active');
      ta.value = '';
      onCaptureType();
      setTimeout(() => ta.focus(), 380);
    }

    function onCaptureType() {
      const ta = document.getElementById('capture-textarea');
      document.getElementById('capture-char').textContent = ta.value.length;
    }

    function trashCapture() {
      document.getElementById('capture-textarea').value = '';
      document.getElementById('capture-sheet').classList.remove('active');
    }

    function dismissCapture() {
      // Auto-discard accidental taps — under 2 chars
      const text = document.getElementById('capture-textarea').value.trim();
      if (text.length < 2) { trashCapture(); return; }
      saveCapture();
    }

    async function saveCapture() {
      const ta = document.getElementById('capture-textarea');
      const text = ta.value.trim();

      // Under 2 chars = accidental — discard silently
      if (text.length < 2) { trashCapture(); return; }

      const item = {
        id: crypto.randomUUID ? crypto.randomUUID() : Date.now().toString(36) + Math.random().toString(36).slice(2),
        content: text,
        category: 'uncategorised',
        status: 'fresh',
        createdAt: new Date().toISOString(),
        touchedAt: new Date().toISOString(),
        projectId: null,
        projectPhase: null,
        aiCategory: null,
        confirmed: false,
        mvnaSteps: null,
        mvnaCurrentStep: 0,
        aiPending: !navigator.onLine
      };

      items.unshift(item);
      save();

      // Dismiss
      ta.value = '';
      document.getElementById('capture-sheet').classList.remove('active');
      showToast('Captured ✦');
      updateStats();
      if (S.screen === 'inbox') renderInbox();

      // Queue AI categorisation
      if (navigator.onLine) categoriseItem(item);
    }

    async function categoriseItem(item) {
      try {
        const result = await aiCategorise(item.content);
        const idx = items.findIndex(i => i.id === item.id);
        if (idx === -1) return;
        items[idx].aiCategory = result.category;
        items[idx].aiPending = false;
        save();
        if (S.screen === 'inbox') renderInbox();
        updateStats();
      } catch (e) { }
    }

    // Offline → online: process queued items
    window.addEventListener('online', () => {
      items.filter(i => i.aiPending).forEach(item => categoriseItem(item));
    });

    function confirmCategory(itemId) {
      const idx = items.findIndex(i => i.id === itemId);
      if (idx === -1) return;
      items[idx].category = items[idx].aiCategory || items[idx].category;
      items[idx].confirmed = true;
      items[idx].touchedAt = new Date().toISOString();
      runLifecycle();
      save();
      renderInbox();
    }

    function archiveItem(itemId) {
      const idx = items.findIndex(i => i.id === itemId);
      if (idx === -1) return;
      items[idx].status = 'archived';
      save();
      renderInbox();
      updateStats();
      showToast('Archived');
    }

    // ── INBOX RENDER ─────────────────────────────────────────
    function setFilter(btn, filter) {
      document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
      btn.classList.add('active');
      S.filter = filter;
      renderInbox();
    }

    function renderInbox() {
      runLifecycle();
      const list = document.getElementById('inbox-list');
      const title = document.getElementById('inbox-title');

      const active = items.filter(i => i.status !== 'archived');
      const filtered = S.filter === 'all'
        ? active
        : active.filter(i => (i.aiCategory || i.category) === S.filter);

      const fresh = filtered.filter(i => i.status === 'fresh' || i.status === 'alive');
      const quiet = filtered.filter(i => i.status === 'quiet');

      // Dynamic title
      const freshCount = items.filter(i => i.status === 'fresh').length;
      if (title) title.textContent = freshCount > 0
        ? `${freshCount} fresh item${freshCount !== 1 ? 's' : ''}`
        : 'Everything';

      if (filtered.length === 0) {
        list.innerHTML = `
      <div class="inbox-empty">
        <div class="inbox-empty-orb"></div>
        <p class="inbox-empty-text">Nothing here yet.<br>Capture something.</p>
      </div>`;
        return;
      }

      let html = fresh.map(renderItemHTML).join('');

      // Quiet items — collapsed block, not dimmed text
      if (quiet.length > 0) {
        html += `
      <div class="quiet-block ${S.quietExpanded ? 'open' : ''}" onclick="toggleQuiet()">
        <span class="quiet-block-label">${quiet.length} quiet item${quiet.length !== 1 ? 's' : ''}</span>
        <span class="quiet-block-chevron">↓</span>
      </div>`;
        if (S.quietExpanded) {
          html += quiet.map(i => renderItemHTML(i, true)).join('');
        }
      }

      list.innerHTML = html;
    }

    function toggleQuiet() {
      S.quietExpanded = !S.quietExpanded;
      renderInbox();
    }

    function renderItemHTML(item, isQuiet = false) {
      const cat = item.aiCategory || item.category;
      const label = CAT_LABELS[cat] || 'Uncategorised';
      const isPending = item.aiCategory && !item.confirmed;
      const isConfirmed = item.confirmed;
      const tagClass = isPending ? 'pending' : (isConfirmed ? 'confirmed' : '');
      const tagAction = isPending ? `onclick="confirmCategory('${item.id}')"` : '';
      const pendingHint = isPending ? `<span class="ai-suggest-hint">AI suggests · tap to confirm</span>` : '';
      const offlineDot = item.aiPending ? `<span class="ai-pending-dot"></span>` : '';

      const developBtn = (cat === 'project')
        ? `<button class="inbox-item-develop" onclick="promoteToProject('${item.id}')">Develop →</button>`
        : '';

      return `
    <div class="inbox-item cat-${cat}${isQuiet ? ' status-quiet' : ''}" onclick="openItemAction('${item.id}')">
      <div class="inbox-item-bar"></div>
      <p class="inbox-item-content">${esc(item.content)}</p>
      <div class="inbox-item-footer">
        <span class="inbox-item-time">${offlineDot}${timeAgo(item.createdAt)}</span>
        <span class="cat-tag ${tagClass}" ${tagAction}>${label}</span>
        ${pendingHint}
        ${developBtn}
        <button class="inbox-item-archive" onclick="archiveItem('${item.id}')" title="Archive">↓</button>
      </div>
    </div>`;
    }

    // ── WORK MODE ─────────────────────────────────────────────
    function renderWork() {
      runLifecycle();
      const eyebrow = document.getElementById('work-eyebrow');
      const headline = document.getElementById('work-headline');
      const area = document.getElementById('work-area');
      const thinking = document.getElementById('ai-thinking');

      thinking.classList.remove('visible');

      const session = S.rewindSession;
      const moodInfo = session ? (MOOD_MAP[session.mood] || MOOD_MAP.Okay) : null;
      S.maxSteps = moodInfo ? moodInfo.maxSteps : 3;
      S.attentionState = moodInfo ? moodInfo.state : null;

      headline.textContent = moodInfo ? moodInfo.label : 'Ready when you are.';

      const candidate = pickWorkItem(moodInfo);

      if (!candidate) {
        area.innerHTML = `
      <div class="work-empty">
        <p class="work-empty-text">Your inbox is clear.<br>Nothing to surface right now.</p>
        <p class="work-empty-cta" onclick="openCapture()">+ Capture something new</p>
      </div>`;
        return;
      }

      S.currentWorkItem = candidate;
      S.mvnaSteps = [];
      S.mvnaStep = 0;

      const cat = candidate.aiCategory || candidate.category;
      const label = CAT_LABELS[cat] || '';

      // If it's a project, show phase + next action as the work card
      const isProject = cat === 'project';
      const linkedProject = isProject ? projects.find(p => p.name && candidate.content.toLowerCase().includes(p.name.toLowerCase())) : null;
      const projectContext = linkedProject
        ? `<div class="task-project-context">
        <span class="project-phase-pill" style="margin-right:8px">${PHASE_LABELS[linkedProject.phase] || ''}</span>
        ${linkedProject.nextAction ? `<span class="task-card-context">${esc(linkedProject.nextAction)}</span>` : ''}
       </div>`
        : '';

      area.innerHTML = `
    <div class="task-card">
      <p class="task-card-context">${label}</p>
      ${projectContext}
      <p class="task-card-title">${esc(candidate.content)}</p>
      <div class="task-card-btns">
        <button class="task-btn primary" onclick="enterFocus()">Begin →</button>
        <button class="task-btn muted" onclick="skipTask()">Not now</button>
      </div>
    </div>
    <div class="mvna-wrap" id="mvna-wrap"></div>`;

      // Help Me Start button
      const helpBtn = document.createElement('button');
      helpBtn.className = 'help-btn';
      helpBtn.textContent = 'Help me start →';
      helpBtn.onclick = () => runHelpMeStart(candidate);
      area.appendChild(helpBtn);
    }

    function pickWorkItem(moodInfo) {
      const available = items.filter(i =>
        i.status !== 'archived' &&
        i.category !== 'spark' // sparks go to library, not work queue
      );
      if (!available.length) return null;

      // Heavy/Fatigued: prefer shortest/freshest only
      if (moodInfo && moodInfo.state === 'fatigued') {
        const fresh = available.filter(i => i.status === 'fresh');
        return fresh[0] || available[0];
      }
      const fresh = available.filter(i => i.status === 'fresh');
      return fresh[0] || available[0];
    }

    async function runHelpMeStart(item) {
      const helpBtn = document.querySelector('.help-btn');
      const thinking = document.getElementById('ai-thinking');
      const wrap = document.getElementById('mvna-wrap');

      if (helpBtn) helpBtn.style.display = 'none';
      thinking.classList.add('visible');

      try {
        const steps = await helpMeStartAI({
          task: item.content,
          projectId: item.projectId,
          projectPhase: item.projectPhase,
          moodState: S.attentionState,
          maxSteps: S.maxSteps,
          completedSteps: []
        });

        S.mvnaSteps = steps;
        S.mvnaStep = 0;

        const idx = items.findIndex(i => i.id === item.id);
        if (idx !== -1) {
          items[idx].mvnaSteps = steps;
          items[idx].mvnaCurrentStep = 0;
          save();
        }

        thinking.classList.remove('visible');
        wrap.classList.add('visible');
        renderMvna(wrap, steps);
      } catch (e) {
        thinking.classList.remove('visible');
        if (helpBtn) helpBtn.style.display = '';
        showToast('Could not connect. Try again.');
      }
    }

    function renderMvna(container, steps) {
      container.innerHTML = steps.map((step, i) => {
        const current = i === S.mvnaStep;
        const done = i < S.mvnaStep;
        return `
      <div class="mvna-step ${current ? 'current' : ''} ${done ? 'done' : ''}">
        <div class="mvna-step-num">${done ? '✓' : i + 1}</div>
        <p class="mvna-step-text">${esc(step)}</p>
        ${current ? `<button class="mvna-done-btn" onclick="completeStep(${i})">✓</button>` : ''}
      </div>`;
      }).join('');
    }

    function completeStep(idx) {
      S.mvnaStep = idx + 1;
      const wrap = document.getElementById('mvna-wrap');
      if (wrap) renderMvna(wrap, S.mvnaSteps);
      if (S.mvnaStep >= S.mvnaSteps.length) {
        showToast('All steps done. That counts.');
        setTimeout(() => { touchItem(S.currentWorkItem.id); renderWork(); }, 1200);
      }
    }

    function skipTask() {
      if (S.currentWorkItem) touchItem(S.currentWorkItem.id);
      S.currentWorkItem = null;
      renderWork();
    }

    function touchItem(id) {
      const idx = items.findIndex(i => i.id === id);
      if (idx !== -1) { items[idx].touchedAt = new Date().toISOString(); items[idx].status = 'alive'; save(); }
    }

    // ── FOCUS STATE ───────────────────────────────────────────
    function enterFocus() {
      const item = S.currentWorkItem;
      if (!item) return;

      document.getElementById('focus-task-text').textContent = item.content;
      document.getElementById('focus-overlay').classList.add('active');

      S.focusActive = true;
      S.focusStart = Date.now();
      clearInterval(S.focusTimer);
      S.focusTimer = setInterval(checkFocusTime, 60000);
    }

    function checkFocusTime() {
      if (!S.focusActive || !S.focusStart) return;
      const mins = (Date.now() - S.focusStart) / 60000;
      const ring = document.getElementById('focus-time-ring');
      const msg = document.getElementById('focus-gentle-msg');

      if (mins >= 120) {
        ring.className = 'focus-time-ring glow-90';
        msg.classList.add('visible');
      } else if (mins >= 90) {
        ring.className = 'focus-time-ring glow-90';
      } else if (mins >= 45) {
        ring.className = 'focus-time-ring glow-45';
      }
    }

    function completeFocus() {
      if (S.currentWorkItem) { archiveItem(S.currentWorkItem.id); S.currentWorkItem = null; }
      exitFocus();
      showToast('Done. That counts.');
      setTimeout(() => renderWork(), 400);
    }

    function exitFocus() {
      document.getElementById('focus-overlay').classList.remove('active');
      document.getElementById('focus-time-ring').className = 'focus-time-ring';
      document.getElementById('focus-gentle-msg').classList.remove('visible');
      S.focusActive = false;
      clearInterval(S.focusTimer);
    }

    // ── HOME SCREEN ───────────────────────────────────────────
    function renderHome() {
      const line = document.getElementById('home-state-line');
      // rewind card is now inline in hero state line — no separate slot
      const session = S.rewindSession;

      const ICONS = { Heavy: '🌧', Tired: '🌫', Restless: '⚡', Okay: '🌤', Calm: '🌊', Alive: '✨' };

      if (!session) {
        line.className = 'home-state-line no-session';
        line.innerHTML = `Open <strong style="color:var(--warm)">Rewind</strong> to check in for a better experience.`;
        // no slot to update
      } else {
        const moodInfo = MOOD_MAP[session.mood] || MOOD_MAP.Okay;
        const icon = ICONS[session.mood] || '';
        line.className = 'home-state-line';
        line.innerHTML = `${icon} <em>${session.mood}</em> &middot; ${moodInfo.label}`;
        // mood shown inline in state line
        S.attentionState = moodInfo.state;
      }

      updateStats();
    }

    function updateStats() {
      runLifecycle();
      const active = items.filter(i => i.status !== 'archived');
      const fresh = items.filter(i => i.status === 'fresh');
      document.getElementById('stat-inbox').textContent = active.length;
      document.getElementById('stat-fresh').textContent = fresh.length;
      updateOrbPulse();
    }

    // ── ORIENTATION PILL ──────────────────────────────────────
    let pillTimer = null;
    function showPill(mode) {
      const pill = document.getElementById('mode-pill');
      if (!pill) return;
      clearTimeout(pillTimer);
      const pillMode = (mode === 'projects' || mode === 'inbox') ? 'plan' : mode;
      pill.className = 'mode-pill ' + pillMode;
      pill.textContent = mode === 'projects' ? 'Projects' : mode === 'inbox' ? 'Inbox' : 'Work';
      // Force reflow then show
      pill.getBoundingClientRect();
      pill.classList.add('visible');
      pillTimer = setTimeout(() => pill.classList.remove('visible'), 2200);
    }

    // ── NAVIGATION ────────────────────────────────────────────
    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById('screen-' + id).classList.add('active');

      // Ambient colour shift
      document.body.classList.remove('mode-plan', 'mode-work');
      if (id === 'projects' || id === 'inbox') document.body.classList.add('mode-plan');

      // Orb state — shift colour on Plan, return to amber on Work/Home
      const orb = document.getElementById('hero-orb-wrap');
      if (orb) {
        orb.classList.remove('state-plan');
        if (id === 'projects') orb.classList.add('state-plan');
      }

      // Orientation pill — only on plan/work entry
      if (id === 'projects' || id === 'inbox' || id === 'work') showPill(id);

      // Bottom nav active state
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      const navMap = { home: 'nav-home', projects: 'nav-projects', inbox: 'nav-inbox', settings: 'nav-settings' };
      if (navMap[id]) { const nb = document.getElementById(navMap[id]); if (nb) nb.classList.add('active'); }

      S.screen = id;

      // Manage body class for home-specific fixed elements
      document.body.classList.toggle('on-home', id === 'home');
      // Hide stats drawer when leaving home
      if (id !== 'home') revealStats(false);

      if (id === 'projects') renderProjects();
      if (id === 'inbox') renderInbox();
      if (id === 'work') renderWork();
      if (id === 'home') renderHome();
    }

    // ── DATA EXPORT ───────────────────────────────────────────
    function exportData() {
      const payload = {
        exported: new Date().toISOString(),
        app: 'Forward', version: '1.0',
        totalItems: items.length, items
      };
      const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = Object.assign(document.createElement('a'), { href: url, download: `forward-backup-${new Date().toISOString().slice(0, 10)}.json` });
      a.click();
      URL.revokeObjectURL(url);
      showToast('Backup downloaded');
    }

    // ── UTILS ─────────────────────────────────────────────────
    function timeAgo(iso) {
      const s = (Date.now() - new Date(iso)) / 1000;
      if (s < 60) return 'just now';
      if (s < 3600) return `${Math.floor(s / 60)}m ago`;
      if (s < 86400) return `${Math.floor(s / 3600)}h ago`;
      const d = new Date(iso);
      return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }

    function esc(str) {
      return (str || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    }

    function showToast(msg) {
      const t = document.getElementById('toast');
      t.textContent = msg; t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 2700);
    }

    // ── SWIPE NAVIGATION ─────────────────────────────────────
    // Horizontal: Work ← Home → Plan
    // Vertical on home: swipe up → reveal stats, swipe down → hide stats
    const SCREEN_ORDER = ['work', 'home', 'projects'];
    let statsRevealed = false;

    function revealStats(show) {
      const drawer = document.getElementById('home-below-fold');
      if (!drawer) return;
      statsRevealed = show;
      if (show) drawer.classList.add('revealed');
      else drawer.classList.remove('revealed');
    }

    function initSwipe() {
      let startX = 0, startY = 0, startTime = 0;

      // Show the handle hint after 1.8s on home
      setTimeout(() => {
        const handle = document.getElementById('stats-handle');
        if (handle) handle.classList.add('visible');
      }, 1800);

      document.addEventListener('touchstart', e => {
        if (e.target.closest('#capture-sheet, .focus-overlay')) return;
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
        startTime = Date.now();
      }, { passive: true });

      document.addEventListener('touchend', e => {
        if (e.target.closest('#capture-sheet, .focus-overlay')) return;
        const dx = e.changedTouches[0].clientX - startX;
        const dy = e.changedTouches[0].clientY - startY;
        const dt = Date.now() - startTime;
        if (dt > 500) return; // too slow

        const isHorizontal = Math.abs(dx) > Math.abs(dy) * 1.4 && Math.abs(dx) > 55;
        const isVertical = Math.abs(dy) > Math.abs(dx) * 1.4 && Math.abs(dy) > 48;

        if (isHorizontal) {
          // Don't fire horizontal swipe on scrollable inbox list
          if (e.target.closest('.inbox-list')) return;
          const cur = S.screen;
          const idx = SCREEN_ORDER.indexOf(cur);
          // If stats drawer is open, first swipe closes it
          if (statsRevealed && cur === 'home') { revealStats(false); return; }
          if (dx < 0 && idx < SCREEN_ORDER.length - 1) showScreen(SCREEN_ORDER[idx + 1]);
          else if (dx > 0 && idx > 0) showScreen(SCREEN_ORDER[idx - 1]);
        }

        if (isVertical && S.screen === 'home') {
          if (dy < 0) revealStats(true);  // swipe up → show stats
          else revealStats(false);         // swipe down → hide stats
        }
      }, { passive: true });
    }

    // ── ORB PULSE INTENSITY — reflects inbox activity ──────────
    function updateOrbPulse() {
      const wrap = document.getElementById('hero-orb-wrap');
      if (!wrap) return;
      const freshCount = items.filter(i => i.status === 'fresh').length;
      const inner = wrap.querySelector('.hero-orb-inner');
      if (!inner) return;
      // Scale glow with freshness — more fresh items = warmer, stronger orb
      if (freshCount >= 5) {
        inner.style.background = 'radial-gradient(circle at 40% 38%, rgba(196,149,106,0.52), rgba(196,149,106,0.1) 70%)';
        inner.style.boxShadow = '0 0 44px rgba(196,149,106,0.22), inset 0 1px 1px rgba(255,255,255,0.08)';
      } else if (freshCount >= 2) {
        inner.style.background = 'radial-gradient(circle at 40% 38%, rgba(196,149,106,0.38), rgba(196,149,106,0.08) 70%)';
        inner.style.boxShadow = '0 0 32px rgba(196,149,106,0.16), inset 0 1px 1px rgba(255,255,255,0.07)';
      } else {
        inner.style.background = '';
        inner.style.boxShadow = '';
      }
    }


    // ══════════════════════════════════════════════════════════
    // PROJECT CATEGORIES + PHASES
    // ══════════════════════════════════════════════════════════
    const PROJECT_CATS = {
      idwork: { label: 'ID Work', badgeClass: 'cat-badge-idwork', phases: ['concept', 'development', 'procurement', 'site', 'delivery'], phaseLabels: { concept: 'Concept', development: 'Development', procurement: 'Procurement', site: 'Site', delivery: 'Delivery' } },
      life: { label: 'Life', badgeClass: 'cat-badge-life', phases: ['seed', 'shaping', 'inmotion', 'integrating'], phaseLabels: { seed: 'Seed', shaping: 'Shaping', inmotion: 'In Motion', integrating: 'Integrating' } },
      business: { label: 'Business', badgeClass: 'cat-badge-business', phases: ['idea', 'validating', 'building', 'operating'], phaseLabels: { idea: 'Idea', validating: 'Validating', building: 'Building', operating: 'Operating' } },
      learning: { label: 'Learning', badgeClass: 'cat-badge-learning', phases: ['curious', 'exploring', 'practising', 'embedding'], phaseLabels: { curious: 'Curious', exploring: 'Exploring', practising: 'Practising', embedding: 'Embedding' } },
      open: { label: 'Open', badgeClass: 'cat-badge-open', phases: ['start', 'middle', 'end'], phaseLabels: { start: 'Start', middle: 'Middle', end: 'End' } }
    };

    const AI_PERSONAS = {
      idwork: 'You are a calm, experienced interior design project coordinator. You understand design phases deeply — concept, development, procurement, site, delivery. Your suggestions are specific, physical, and sequenced.',
      life: 'You are a warm, grounded personal coach. You help people move through life projects with clarity and self-compassion. Your suggestions are gentle, honest, and sized to what feels possible today.',
      business: 'You are a sharp, lean thinking partner for business and entrepreneurial work. You help cut through noise, find the real next move, and keep momentum without overwhelm.',
      learning: 'You are a patient, curious learning guide. You help people build knowledge and skill progressively. You know that learning compounds — you always suggest the smallest step that builds on what\'s already known.',
      open: 'You are a thoughtful, adaptive thinking partner. You meet the person where they are and help them find the clearest next step.'
    };

    // ── PROJECT CATEGORY FILTER ──────────────────────────────
    let activeCatFilter = 'all';

    function setCatFilter(btn, cat) {
      activeCatFilter = cat;
      document.querySelectorAll('.cat-filter-chip').forEach(b => b.classList.toggle('active', b.dataset.cat === cat));
      renderProjects();
    }

    // ── RENDER PROJECTS ──────────────────────────────────────
    function renderProjects() {
      const container = document.getElementById('project-cards');
      if (!container) return;
      const filtered = projects.filter(p => p.status !== 'archived' && (activeCatFilter === 'all' || p.projectCat === activeCatFilter));

      const addBtn = '<button class="add-project-btn" onclick="openNewProject(null)">+ new project</button>';

      if (filtered.length === 0) {
        container.innerHTML = `<div style="padding:40px 0;text-align:center"><p style="color:var(--text-muted);font-size:13px;margin-bottom:20px">No projects yet.</p></div>` + addBtn;
        return;
      }
      const cards = filtered.map(p => {
        const catInfo = PROJECT_CATS[p.projectCat] || PROJECT_CATS.open;
        const phaseLabel = catInfo.phaseLabels[p.phase] || p.phase || '';
        return `
    <div class="project-card" onclick="openProjectSheet('${p.id}')">
      <span class="cat-badge ${catInfo.badgeClass}">${catInfo.label}</span>
      <p class="project-card-name">${esc(p.name)}</p>
      ${p.vision ? `<p class="project-card-vision">${esc(p.vision)}</p>` : ''}
      <div class="project-card-footer">
        <span class="project-phase-pill">${phaseLabel}</span>
        ${p.nextAction ? `<span class="project-next-preview">${esc(p.nextAction)}</span>` : '<span style="font-size:11px;color:var(--text-muted);opacity:0.5">No next action</span>'}
      </div>
    </div>`;
      }).join('');
      container.innerHTML = cards + addBtn;
    }

    // ── PROJECT DETAIL SHEET ─────────────────────────────────
    function openProjectSheet(id) {
      const p = projects.find(x => x.id === id);
      if (!p) return;
      editingProjectId = id;
      psPhase = p.phase || Object.keys((PROJECT_CATS[p.projectCat] || PROJECT_CATS.open).phaseLabels)[0];

      document.getElementById('ps-name').value = p.name || '';
      document.getElementById('ps-vision').textContent = p.vision || 'No vision captured.';
      document.getElementById('ps-next-action').value = p.nextAction || '';
      document.getElementById('ps-notes').value = p.notes || '';

      // Rebuild phase pills for this category
      const catInfo = PROJECT_CATS[p.projectCat] || PROJECT_CATS.open;
      const pillsEl = document.querySelector('.project-sheet .phase-pills');
      if (pillsEl) {
        pillsEl.innerHTML = catInfo.phases.map(ph =>
          `<button class="phase-pill-btn${ph === psPhase ? ' active' : ''}" data-phase="${ph}" onclick="setProjectPhase('${ph}')">${catInfo.phaseLabels[ph]}</button>`
        ).join('');
      }

      // Reset AI thread
      document.getElementById('project-ai-thread').classList.remove('open');
      document.getElementById('ai-messages').innerHTML = '';
      document.getElementById('project-ai-btn-label').textContent = 'Talk to AI →';

      document.getElementById('project-sheet').classList.add('active');

      // Auto-suggest next action if empty
      if (!p.nextAction) setTimeout(() => autoSuggestNextAction(p), 800);
    }

    function setProjectPhase(phase) {
      psPhase = phase;
      document.querySelectorAll('.project-sheet .phase-pill-btn').forEach(b => b.classList.toggle('active', b.dataset.phase === phase));
    }

    function saveProjectSheet() {
      if (!editingProjectId) return;
      const p = projects.find(x => x.id === editingProjectId);
      if (!p) return;
      p.name = document.getElementById('ps-name').value.trim() || p.name;
      p.phase = psPhase;
      p.nextAction = document.getElementById('ps-next-action').value.trim();
      p.notes = document.getElementById('ps-notes').value.trim();
      p.touchedAt = new Date().toISOString();
      saveProjects();
      renderProjects();
      closeProjectSheet();
      showToast('Project saved');
    }

    function closeProjectSheet() {
      document.getElementById('project-sheet').classList.remove('active');
      editingProjectId = null;
    }

    // ── AUTO-SUGGEST NEXT ACTION ─────────────────────────────
    async function autoSuggestNextAction(p) {
      const nextInput = document.getElementById('ps-next-action');
      if (!nextInput || nextInput.value.trim()) return;
      nextInput.placeholder = 'AI is thinking…';
      // Simulate for now — swap for Claude API
      await new Promise(r => setTimeout(r, 1400));
      const catInfo = PROJECT_CATS[p.projectCat] || PROJECT_CATS.open;
      const phase = catInfo.phaseLabels[p.phase] || p.phase;
      const suggestions = {
        idwork: { concept: 'Pull three reference images that capture the feeling', development: 'Review the last drawing set and mark one decision', procurement: 'Follow up on the longest outstanding quote', site: 'Check the punch list and call the first contractor', delivery: 'Send the client the final documentation checklist' },
        life: { seed: 'Write one sentence about why this matters', shaping: 'Name the first real action that would move this', inmotion: 'Check in on where this sits today', integrating: 'Notice what has already shifted' },
        business: { idea: 'Write the problem you\'re solving in one sentence', validating: 'Talk to one person who has this problem', building: 'Identify the one thing blocking progress', operating: 'Review last week\'s numbers' },
        learning: { curious: 'Find one resource and save it', exploring: 'Spend 20 minutes with the material', practising: 'Do one exercise without notes', embedding: 'Teach this to someone or write it out' }
      };
      const catSuggestions = suggestions[p.projectCat];
      const suggestion = (catSuggestions && catSuggestions[p.phase]) ? catSuggestions[p.phase] : 'Identify the one smallest next step';
      nextInput.placeholder = suggestion;
    }

    // ── AI COMPANION IN PROJECT ──────────────────────────────
    function toggleProjectAI() {
      const thread = document.getElementById('project-ai-thread');
      const label = document.getElementById('project-ai-btn-label');
      const isOpen = thread.classList.contains('open');
      if (!isOpen) {
        thread.classList.add('open');
        label.textContent = 'AI active ·';
        // Auto-read project on first open
        if (document.getElementById('ai-messages').children.length === 0) {
          const p = projects.find(x => x.id === editingProjectId);
          if (p) setTimeout(() => aiReadProject(p), 400);
        }
      } else {
        thread.classList.remove('open');
        label.textContent = 'Talk to AI →';
      }
    }

    async function aiReadProject(p) {
      const catInfo = PROJECT_CATS[p.projectCat] || PROJECT_CATS.open;
      const phase = catInfo.phaseLabels[p.phase] || p.phase || '';
      const mood = (S.rewindSession && S.rewindSession.mood) ? S.rewindSession.mood : null;
      showAIThinking(true);
      await new Promise(r => setTimeout(r, 1800));
      showAIThinking(false);
      const moodLine = mood ? ` You're coming in feeling ${mood.toLowerCase()} today.` : '';
      const response = buildAIReadResponse(p, phase, mood);
      appendAIMessage(response, p);
    }

    function buildAIReadResponse(p, phase, mood) {
      const fatigued = ['Heavy', 'Tired'].includes(mood);
      const alive = ['Alive', 'Calm'].includes(mood);
      const maxSteps = fatigued ? 1 : alive ? 3 : 2;
      const catInfo = PROJECT_CATS[p.projectCat] || PROJECT_CATS.open;

      // Phase-aware read for each category
      const reads = {
        idwork: `<em>${p.name}</em> is in ${phase}. ${p.nextAction ? `The declared next step is: "${p.nextAction}".` : 'No next step set yet.'}`,
        life: `<em>${p.name}</em> — you placed this in ${phase}. ${p.vision ? `You wrote: "${p.vision.substring(0, 80)}…"` : ''} Let's find what's true right now.`,
        business: `<em>${p.name}</em> is at ${phase}. ${p.nextAction ? `You said the next move was: "${p.nextAction}".` : 'No move declared yet.'} What's the actual blocker?`,
        learning: `<em>${p.name}</em> — you're in the ${phase} stage. The question is always: what's the one thing to do with the next 20 minutes?`,
        open: `<em>${p.name}</em> — ${phase}. What's true about where this sits right now?`
      };
      const read = reads[p.projectCat] || reads.open;
      return { text: read, maxSteps };
    }

    function appendAIMessage(response, p) {
      const msgs = document.getElementById('ai-messages');
      if (!msgs) return;
      const div = document.createElement('div');
      div.className = 'ai-message';
      div.innerHTML = `<p class="ai-message-text">${response.text}</p>`;
      msgs.appendChild(div);

      // Auto-generate steps if maxSteps available
      if (response.steps && response.steps.length) {
        renderAISteps(response.steps);
      }
      msgs.scrollTop = msgs.scrollHeight;
    }

    function renderAISteps(steps) {
      const msgs = document.getElementById('ai-messages');
      if (!msgs) return;
      const wrap = document.createElement('div');
      wrap.className = 'ai-message';
      wrap.innerHTML = steps.map((s, i) => `
    <div class="ai-step-item" id="ai-step-${i}">
      <button class="ai-step-check" id="ai-step-check-${i}" onclick="toggleAIStep(${i})"></button>
      <span class="ai-step-text" id="ai-step-text-${i}">${esc(s)}</span>
    </div>`).join('');
      msgs.appendChild(wrap);
    }

    function toggleAIStep(i) {
      const check = document.getElementById(`ai-step-check-${i}`);
      const text = document.getElementById(`ai-step-text-${i}`);
      if (check && text) {
        check.classList.toggle('done');
        text.classList.toggle('done');
      }
    }

    async function sendProjectAI() {
      const input = document.getElementById('project-ai-input');
      const msg = input ? input.value.trim() : '';
      if (!msg) return;
      input.value = '';

      // Show user message
      const msgs = document.getElementById('ai-messages');
      const userDiv = document.createElement('div');
      userDiv.className = 'ai-message';
      userDiv.style.background = 'rgba(196,149,106,0.08)';
      userDiv.style.borderLeft = '2px solid rgba(196,149,106,0.3)';
      userDiv.innerHTML = `<p class="ai-message-text" style="color:var(--text)">${esc(msg)}</p>`;
      msgs.appendChild(userDiv);
      msgs.scrollTop = msgs.scrollHeight;

      showAIThinking(true);
      const p = projects.find(x => x.id === editingProjectId);
      await new Promise(r => setTimeout(r, 1600));
      showAIThinking(false);

      // Generate response based on category persona and message
      const mood = S.rewindSession ? S.rewindSession.mood : null;
      const fatigued = ['Heavy', 'Tired'].includes(mood);
      const maxSteps = fatigued ? 1 : 2;
      const catInfo = (p && p.projectCat && PROJECT_CATS[p.projectCat]) ? PROJECT_CATS[p.projectCat] : PROJECT_CATS.open;
      const phase = p ? (catInfo.phaseLabels[p.phase] || p.phase) : '';

      let replyText = '';
      let steps = [];

      if (/stuck|block|can't|not sure|don't know/i.test(msg)) {
        replyText = `Being stuck in ${phase} usually means one of two things: the next action is too large, or there's a decision underneath it that hasn't been made. Which feels more true?`;
      } else if (/next|what|do|start|begin/i.test(msg)) {
        replyText = `Given you're in ${phase} and ${mood ? `feeling ${mood.toLowerCase()}` : 'where you are today'}, here are the right-sized next steps:`;
        steps = fatigued
          ? ['Do just one thing — the very first physical action you can take right now']
          : ['Open whatever you need to start', 'Do the first action only — decide nothing else yet', 'Note what you learn or what shifts'];
      } else {
        replyText = `Noted. Given where <em>${(p && p.name) ? p.name : 'this project'}</em> is — ${phase} — what would make the next hour count?`;
      }

      const response = { text: replyText, steps: steps.slice(0, maxSteps) };
      appendAIMessage(response, p);
      if (steps.length) renderAISteps(steps.slice(0, maxSteps));
    }

    function showAIThinking(show) {
      const el = document.getElementById('ai-thinking-inline');
      if (el) el.classList.toggle('visible', show);
    }

    // ── ITEM ACTION SHEET ────────────────────────────────────
    let activeItemId = null;
    let iaCurrentCat = null;

    function openItemAction(itemId) {
      const item = items.find(i => i.id === itemId);
      if (!item) return;
      activeItemId = itemId;
      iaCurrentCat = item.aiCategory || item.category;

      document.getElementById('ia-content').textContent = item.content;
      document.querySelectorAll('.item-action-cat-btn').forEach(b => {
        b.classList.toggle('active', b.dataset.cat === iaCurrentCat);
      });
      document.getElementById('item-action-sheet').classList.add('active');
    }

    function iaSetCat(cat) {
      iaCurrentCat = cat;
      document.querySelectorAll('.item-action-cat-btn').forEach(b => b.classList.toggle('active', b.dataset.cat === cat));
      // Save immediately
      const item = items.find(i => i.id === activeItemId);
      if (item) { item.category = cat; item.aiCategory = cat; item.confirmed = true; save(); }
    }

    function iaPromote() {
      const item = items.find(i => i.id === activeItemId);
      if (item) {
        closeItemAction();
        setTimeout(() => openNewProject(item.content), 200);
      }
    }

    function iaArchive() {
      if (activeItemId) archiveItem(activeItemId);
      closeItemAction();
    }

    function closeItemAction() {
      document.getElementById('item-action-sheet').classList.remove('active');
      activeItemId = null;
      renderInbox();
    }

    // ── ARCHIVE RECOVERY ─────────────────────────────────────
    let archiveOpen = false;
    function toggleArchive() {
      archiveOpen = !archiveOpen;
      const toggle = document.getElementById('archive-toggle');
      const list = document.getElementById('archive-list');
      toggle.classList.toggle('open', archiveOpen);
      list.classList.toggle('open', archiveOpen);
      if (archiveOpen) renderArchive();
    }

    function renderArchive() {
      const list = document.getElementById('archive-list');
      if (!list) return;
      const archived = items.filter(i => i.status === 'archived');
      if (!archived.length) { list.innerHTML = '<p style="padding:16px 4px;font-size:12px;color:var(--text-muted)">Nothing archived.</p>'; return; }
      list.innerHTML = archived.map(item => `
    <div class="archived-item">
      <span class="archived-item-text">${esc(item.content)}</span>
      <button class="archived-item-restore" onclick="restoreItem('${item.id}')">Restore</button>
    </div>`).join('');
    }

    function restoreItem(id) {
      const item = items.find(i => i.id === id);
      if (item) { item.status = 'fresh'; item.touchedAt = new Date().toISOString(); save(); renderArchive(); renderInbox(); showToast('Restored'); }
    }

    // ── NEW PROJECT — category selection ─────────────────────
    let npCat = 'idwork';
    function npSetCat(cat) {
      npCat = cat;
      document.querySelectorAll('.np-cat-btn').forEach(b => b.classList.toggle('active', b.dataset.npcat === cat));
    }



    // ── NEW PROJECT FLOW ─────────────────────────────────────
    function openNewProject(prefillText) {
      npCat = 'idwork';
      npPhase = 'concept';
      document.getElementById('np-name').value = '';
      document.getElementById('np-vision').value = prefillText || '';
      document.querySelectorAll('.np-cat-btn').forEach(b => b.classList.toggle('active', b.dataset.npcat === 'idwork'));
      document.querySelectorAll('#np-phase-pills .phase-pill-btn').forEach(b => b.classList.remove('active'));
      const firstPill = document.querySelector('#np-phase-pills .phase-pill-btn');
      if (firstPill) firstPill.classList.add('active');
      document.getElementById('np-step-1').classList.add('active');
      document.getElementById('np-step-2').classList.remove('active');
      document.getElementById('new-project-sheet').classList.add('active');
      setTimeout(() => document.getElementById('np-name').focus(), 400);
    }

    function npBackStep() {
      document.getElementById('np-step-2').classList.remove('active');
      document.getElementById('np-step-1').classList.add('active');
    }

    function npSetPhase(phase) {
      npPhase = phase;
      document.querySelectorAll('#np-phase-pills .phase-pill-btn').forEach(b => b.classList.toggle('active', b.dataset.phase === phase));
    }

    function npCreate() {
      const name = document.getElementById('np-name').value.trim();
      const vision = document.getElementById('np-vision').value.trim();
      if (!name) { npBackStep(); return; }
      const catInfo = PROJECT_CATS[npCat] || PROJECT_CATS.open;
      const defaultPhase = catInfo.phases[0];
      const project = {
        id: crypto.randomUUID ? crypto.randomUUID() : Date.now().toString(36) + Math.random().toString(36).slice(2),
        name, vision,
        projectCat: npCat,
        phase: npPhase || defaultPhase,
        nextAction: '', notes: '',
        status: 'active',
        createdAt: new Date().toISOString(),
        touchedAt: new Date().toISOString()
      };
      projects.unshift(project);
      saveProjects();
      closeNewProject();
      renderProjects();
      showToast('Project created');
      setTimeout(() => openProjectSheet(project.id), 350);
    }

    function closeNewProject() {
      document.getElementById('new-project-sheet').classList.remove('active');
    }

    function promoteToProject(itemId) {
      const item = items.find(i => i.id === itemId);
      if (!item) return;
      closeItemAction();
      setTimeout(() => openNewProject(item.content), 250);
    }


    function npNextStep() {
      const name = document.getElementById('np-name').value.trim();
      if (!name) { document.getElementById('np-name').focus(); return; }
      const catInfo = PROJECT_CATS[npCat] || PROJECT_CATS.open;
      npPhase = catInfo.phases[0];
      const pillsEl = document.getElementById('np-phase-pills');
      if (pillsEl) {
        pillsEl.innerHTML = catInfo.phases.map((ph, i) =>
          `<button class="phase-pill-btn${i === 0 ? ' active' : ''}" data-phase="${ph}" onclick="npSetPhase('${ph}')">${catInfo.phaseLabels[ph]}</button>`
        ).join('');
      }
      document.getElementById('np-step-1').classList.remove('active');
      document.getElementById('np-step-2').classList.add('active');
    }

    // ── INIT ──────────────────────────────────────────────────
    function init() {
      load();
      loadProjects();
      runLifecycle();
      S.rewindSession = loadRewind();
      // Ensure projects screen exists
      if (!document.getElementById('screen-projects')) console.warn('screen-projects missing');

      // Ambient orbs
      setTimeout(() => document.querySelectorAll('.ambient-orb').forEach(o => o.classList.add('visible')), 450);

      renderHome();
      document.body.classList.add('on-home');

      // Swipe navigation
      initSwipe();

      // Backup nudge — once, after 7 days of use
      if (items.length > 0) {
        const oldest = items[items.length - 1];
        const days = (Date.now() - new Date(oldest.createdAt)) / 86400000;
        if (days >= 7 && !localStorage.getItem('forward_backup_nudged')) {
          setTimeout(() => {
            showToast('Tip: back up your data in Settings');
            localStorage.setItem('forward_backup_nudged', '1');
          }, 3200);
        }
      }
    }

    init();
  </script>

  <!-- PROJECT DETAIL SHEET -->
  <div class="project-sheet" id="project-sheet">
    <div class="project-sheet-modal">
      <div class="project-sheet-handle"></div>
      <div class="project-sheet-scroll">

        <!-- Name -->
        <div class="project-sheet-section">
          <p class="project-sheet-eyebrow">Project</p>
          <input class="project-sheet-name" id="ps-name" type="text" placeholder="Project name" />
        </div>

        <!-- Vision — locked -->
        <div class="project-sheet-section">
          <p class="project-sheet-eyebrow">The Vision</p>
          <div class="project-vision-text" id="ps-vision"></div>
          <p class="project-vision-locked">captured when you believed in this · cannot be edited</p>
        </div>

        <!-- Phase -->
        <div class="project-sheet-section">
          <p class="project-sheet-eyebrow">Phase</p>
          <div class="phase-pills">
            <button class="phase-pill-btn" data-phase="concept" onclick="setProjectPhase('concept')">Concept</button>
            <button class="phase-pill-btn" data-phase="development"
              onclick="setProjectPhase('development')">Development</button>
            <button class="phase-pill-btn" data-phase="procurement"
              onclick="setProjectPhase('procurement')">Procurement</button>
            <button class="phase-pill-btn" data-phase="site" onclick="setProjectPhase('site')">Site</button>
            <button class="phase-pill-btn" data-phase="delivery" onclick="setProjectPhase('delivery')">Delivery</button>
          </div>
        </div>

        <!-- Next action -->
        <div class="project-sheet-section">
          <p class="project-sheet-eyebrow">Next Action</p>
          <input class="project-input" id="ps-next-action" type="text" placeholder="The one small next step…" />
        </div>

        <!-- Notes -->
        <div class="project-sheet-section">
          <p class="project-sheet-eyebrow">Notes</p>
          <textarea class="project-input" id="ps-notes" rows="4" placeholder="Anything else worth holding…"></textarea>
        </div>

        <button class="project-save-btn" onclick="saveProjectSheet()">Save</button>
      </div>
    </div>
    <div style="flex:1" onclick="closeProjectSheet()"></div>
  </div>

  <!-- NEW PROJECT SHEET — 2 steps -->
  <div class="new-project-sheet" id="new-project-sheet">
    <div class="new-project-modal">
      <div class="new-project-handle"></div>

      <!-- Step 1: Name + Category + Vision -->
      <div class="new-project-step active" id="np-step-1">
        <p class="new-project-label">New Project — Step 1 of 2</p>
        <p class="new-project-title">Name it, place it, capture the vision</p>
        <input class="project-input" id="np-name" type="text" placeholder="Project name…" style="margin-bottom:14px" />
        <div class="np-category-grid" id="np-category-grid">
          <button class="np-cat-btn active" data-npcat="idwork" onclick="npSetCat('idwork')">
            <div class="np-cat-btn-name">ID Work</div>
            <div class="np-cat-btn-desc">Interior design project</div>
          </button>
          <button class="np-cat-btn" data-npcat="life" onclick="npSetCat('life')">
            <div class="np-cat-btn-name">Life</div>
            <div class="np-cat-btn-desc">Personal, family, home</div>
          </button>
          <button class="np-cat-btn" data-npcat="business" onclick="npSetCat('business')">
            <div class="np-cat-btn-name">Business</div>
            <div class="np-cat-btn-desc">Ideas, ventures, freelance</div>
          </button>
          <button class="np-cat-btn" data-npcat="learning" onclick="npSetCat('learning')">
            <div class="np-cat-btn-name">Learning</div>
            <div class="np-cat-btn-desc">Courses, skills, reading</div>
          </button>
          <button class="np-cat-btn" data-npcat="open" onclick="npSetCat('open')" style="grid-column:span 2">
            <div class="np-cat-btn-name">Open</div>
            <div class="np-cat-btn-desc">I'll define my own path</div>
          </button>
        </div>
        <textarea class="project-input" id="np-vision" rows="3"
          placeholder="What did you see when you believed in this? Capture it now, while it's alive…"
          style="margin-top:14px"></textarea>
        <button class="new-project-next" onclick="npNextStep()">Next →</button>
        <button class="new-project-back" onclick="closeNewProject()">Cancel</button>
      </div>

      <!-- Step 2: Phase -->
      <div class="new-project-step" id="np-step-2">
        <p class="new-project-label">New Project — Step 2 of 2</p>
        <p class="new-project-title">Where is it right now?</p>
        <div class="phase-pills" id="np-phase-pills">
          <button class="phase-pill-btn" data-phase="concept" onclick="npSetPhase('concept')">Concept</button>
          <button class="phase-pill-btn" data-phase="development"
            onclick="npSetPhase('development')">Development</button>
          <button class="phase-pill-btn" data-phase="procurement"
            onclick="npSetPhase('procurement')">Procurement</button>
          <button class="phase-pill-btn" data-phase="site" onclick="npSetPhase('site')">Site</button>
          <button class="phase-pill-btn" data-phase="delivery" onclick="npSetPhase('delivery')">Delivery</button>
        </div>
        <button class="new-project-next" onclick="npCreate()"
          style="background:rgba(196,149,106,0.1);border-color:rgba(196,149,106,0.25);color:var(--warm)">Create
          project</button>
        <button class="new-project-back" onclick="npBackStep()">← Back</button>
      </div>
    </div>
    <div style="flex:1" onclick="closeNewProject()"></div>
  </div>


  <!-- INBOX ITEM ACTION SHEET -->
  <div class="item-action-sheet" id="item-action-sheet">
    <div class="item-action-modal">
      <div class="item-action-handle"></div>
      <p class="item-action-content" id="ia-content"></p>
      <p class="item-action-label">Category</p>
      <div class="item-action-row" id="ia-cat-row">
        <button class="item-action-cat-btn" data-cat="task" onclick="iaSetCat('task')">Task</button>
        <button class="item-action-cat-btn" data-cat="spark" onclick="iaSetCat('spark')">Spark</button>
        <button class="item-action-cat-btn" data-cat="reminder" onclick="iaSetCat('reminder')">Reminder</button>
        <button class="item-action-cat-btn" data-cat="uncategorised"
          onclick="iaSetCat('uncategorised')">Unsorted</button>
      </div>
      <div class="item-action-divider"></div>
      <button class="item-action-main-btn promote" onclick="iaPromote()">Develop into project →</button>
      <button class="item-action-main-btn archive" onclick="iaArchive()">Archive</button>
      <button class="item-action-main-btn cancel" onclick="closeItemAction()">Cancel</button>
    </div>
    <div style="flex:1" onclick="closeItemAction()"></div>
  </div>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(registration => {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
          })
          .catch(err => {
            console.log('ServiceWorker registration failed: ', err);
          });
      });
    }
  </script>
</body>

</html>